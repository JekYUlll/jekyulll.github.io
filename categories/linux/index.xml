<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Linux on Horeb's Blog â¬†ï¸</title><link>https://jekyulll.github.io/categories/linux/</link><description>Recent content in Linux on Horeb's Blog â¬†ï¸</description><generator>Hugo</generator><language>en</language><copyright>&lt;a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0&lt;/a></copyright><lastBuildDate>Sat, 18 Oct 2025 21:05:47 +0800</lastBuildDate><atom:link href="https://jekyulll.github.io/categories/linux/index.xml" rel="self" type="application/rss+xml"/><item><title>å®éªŒå®¤æœåŠ¡å™¨ä½¿ç”¨æ•™ç¨‹</title><link>https://jekyulll.github.io/posts/normal-%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</link><pubDate>Sat, 18 Oct 2025 21:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/normal-%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</guid><description>&lt;h2 id="ä¸€å‰è¨€">ä¸€ã€å‰è¨€&lt;/h2>
&lt;p>&lt;span style="color: red;">&lt;strong>æ ¡å¤–è®¿é—®è¯·é€šè¿‡æ ¡å›­ VPN&lt;/strong>&lt;/span>&lt;/p>
&lt;h3 id="å†™ä½œç›®çš„">å†™ä½œç›®çš„&lt;/h3>
&lt;p>å®éªŒå®¤è¿‘æœŸæ–°è´­ç½®äº†ä¸€å°æ·±åº¦å­¦ä¹ æœåŠ¡å™¨ï¼Œä¾›æˆå‘˜è¿›è¡Œæ¨¡å‹è®­ç»ƒã€ä»¿çœŸå’Œè®¡ç®—ä»»åŠ¡ã€‚ä¸ºäº†å¸®åŠ©å¤§å®¶å¿«é€Ÿä¸Šæ‰‹ã€è§„èŒƒä½¿ç”¨ã€é¿å…èµ„æºæµªè´¹æˆ–ç³»ç»ŸæŸåï¼Œç‰¹ç¼–å†™æ­¤æ•™ç¨‹ã€‚å†…å®¹æ¶µç›–æœåŠ¡å™¨çš„åŸºæœ¬æ¦‚å¿µã€å„æ“ä½œç³»ç»Ÿä¸‹çš„è¿æ¥æ–¹å¼ã€Conda ç¯å¢ƒçš„ä½¿ç”¨ï¼Œä»¥åŠå›¾å½¢åŒ–ï¼ˆè¿œç¨‹æ¡Œé¢ï¼‰æ“ä½œæ–¹æ³•ã€‚&lt;/p>
&lt;h3 id="é€‚ç”¨äººç¾¤">é€‚ç”¨äººç¾¤&lt;/h3>
&lt;ul>
&lt;li>å¯¹ Linux æˆ–å‘½ä»¤è¡Œä¸ç†Ÿæ‚‰çš„åŒå­¦ï¼›&lt;/li>
&lt;li>éœ€è¦è¿›è¡Œæ·±åº¦å­¦ä¹ ã€æœ‰é™å…ƒä»¿çœŸæˆ–æ•°æ®å¤„ç†çš„ç ”ç©¶ç”Ÿã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="äºŒä»€ä¹ˆæ˜¯æ·±åº¦å­¦ä¹ æœåŠ¡å™¨">äºŒã€ä»€ä¹ˆæ˜¯â€œæ·±åº¦å­¦ä¹ æœåŠ¡å™¨â€&lt;/h2>
&lt;p>æ·±åº¦å­¦ä¹ æœåŠ¡å™¨æ˜¯ä¸€å°é«˜æ€§èƒ½è®¡ç®—æœºï¼Œé€šå¸¸é…å¤‡å¤šå— GPUï¼ˆå›¾å½¢å¤„ç†å™¨ï¼‰ã€å¤§å®¹é‡æ˜¾å­˜ã€å†…å­˜å’Œé«˜é€Ÿå­˜å‚¨ã€‚
é€šå¸¸å®‰è£…Linuxç³»ç»Ÿ ï¼Œä¸€èˆ¬&lt;strong>ä¸ç›´æ¥æ¥æ˜¾ç¤ºå™¨&lt;/strong>ï¼Œè€Œæ˜¯é€šè¿‡ç½‘ç»œè¿œç¨‹è®¿é—®ï¼ˆSSH æˆ–è¿œç¨‹æ¡Œé¢ï¼‰ã€‚&lt;/p>
&lt;h3 id="ä¸»è¦ç”¨é€”">ä¸»è¦ç”¨é€”&lt;/h3>
&lt;ul>
&lt;li>æ·±åº¦å­¦ä¹ è®­ç»ƒï¼ˆå¦‚ PyTorchã€TensorFlowï¼‰ï¼›&lt;/li>
&lt;li>å¤§è§„æ¨¡æœ‰é™å…ƒä»¿çœŸï¼ˆAbaqusã€ANSYSã€COMSOLï¼‰ï¼›&lt;/li>
&lt;li>æ•°æ®åˆ†æã€å›¾åƒè¯†åˆ«ã€æ¨¡å‹ä¼˜åŒ–ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="ç³»ç»Ÿä¸è½¯ä»¶ç¯å¢ƒ">ç³»ç»Ÿä¸è½¯ä»¶ç¯å¢ƒ&lt;/h3>
&lt;ul>
&lt;li>æ“ä½œç³»ç»Ÿï¼šUbuntu 22.04 LTS&lt;/li>
&lt;li>å·²å®‰è£…è½¯ä»¶ï¼šCUDAã€cuDNNã€Anacondaã€Pythonã€JupyterLab&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="ä¸‰è´¦æˆ·ä¸ç™»å½•ä¿¡æ¯">ä¸‰ã€è´¦æˆ·ä¸ç™»å½•ä¿¡æ¯&lt;/h2>
&lt;h3 id="è´¦æˆ·ç”³è¯·">è´¦æˆ·ç”³è¯·&lt;/h3>
&lt;p>æ–°ç”¨æˆ·è¯·è”ç³»å®éªŒå®¤ç®¡ç†å‘˜å¼€é€šã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>è´¦æˆ·å‘½åè§„åˆ™&lt;/strong>
å®éªŒå®¤ç»Ÿä¸€ä»¥&lt;em>å§“åå…¨æ‹¼&lt;/em>ä½œä¸ºç”¨æˆ·åï¼Œä¾‹å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>å¼ ä¸‰ â†’ &lt;em>zhangsan&lt;/em>&lt;/li>
&lt;li>æå›› â†’ &lt;em>lisi&lt;/em>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>åˆå§‹å¯†ç &lt;/strong>
æ‰€æœ‰æ–°è´¦æˆ·çš„åˆå§‹å¯†ç ä¸ºï¼š&lt;code>123456&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="-æ‰‹åŠ¨ä¿®æ”¹å¯†ç å¿…åš">ğŸ” æ‰‹åŠ¨ä¿®æ”¹å¯†ç ï¼ˆå¿…åšï¼‰&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>ç™»å½•æœåŠ¡å™¨åï¼ˆè§åç»­æ•™ç¨‹ï¼‰ï¼Œåœ¨ç»ˆç«¯è¾“å…¥ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>passwd
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>ç³»ç»Ÿä¼šæç¤ºï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>Changing password for user zhangsan.
(current) UNIX password:
&lt;/code>&lt;/pre>&lt;p>è¾“å…¥å½“å‰å¯†ç ï¼ˆå³ &lt;code>123456&lt;/code>ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¥ç€è¾“å…¥æ–°å¯†ç ä¸¤æ¬¡ï¼ˆç³»ç»Ÿä¸ä¼šæ˜¾ç¤ºè¾“å…¥å†…å®¹ï¼Œä½†å®é™…ä¸Šè¾“è¿›å»äº†ï¼‰ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>Enter new UNIX password:
Retype new UNIX password:
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>å¦‚æœä¸¤æ¬¡è¾“å…¥ä¸€è‡´ï¼Œä¼šæ˜¾ç¤ºï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>password updated successfully
&lt;/code>&lt;/pre>&lt;p>è¡¨ç¤ºä¿®æ”¹æˆåŠŸã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="ç½‘ç»œè®¿é—®">ç½‘ç»œè®¿é—®&lt;/h3>
&lt;hr>
&lt;h2 id="å››è¿æ¥æ–¹å¼">å››ã€è¿æ¥æ–¹å¼&lt;/h2>
&lt;h3 id="ä¸€windows-ç”¨æˆ·">ï¼ˆä¸€ï¼‰Windows ç”¨æˆ·&lt;/h3>
&lt;p>æ­¤å¤„æ¨èä¸‰ä¸ªç”¨äºè¿æ¥çš„ç»ˆç«¯å·¥å…·ï¼ˆå°±æ˜¯é»‘çª—å£ï¼Œç†è®ºä¸Šcmdå³å¯ï¼Œä½†ä¸å¤Ÿæ˜“ç”¨ï¼‰ï¼š&lt;/p></description></item><item><title>å®¹å™¨åŒ–æŠ€æœ¯ä¹‹ Linux namespace</title><link>https://jekyulll.github.io/posts/linux-%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF%E4%B9%8B-linux-namespace/</link><pubDate>Sun, 08 Jun 2025 20:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF%E4%B9%8B-linux-namespace/</guid><description>&lt;p>Linux namespaceåšä¸€å±‚èµ„æºéš”ç¦»ï¼Œä½¿é‡Œé¢çš„è¿›ç¨‹/è¿›ç¨‹ç»„çœ‹èµ·æ¥æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹èµ„æºã€‚&lt;/p>
&lt;p>PID namespace ä¸­çš„ &lt;code>init&lt;/code> è¿›ç¨‹ï¼ˆPID=1ï¼‰éœ€è¦æ­£ç¡®å¤„ç†å­è¿›ç¨‹çš„åƒµå°¸çŠ¶æ€ï¼Œå¦åˆ™ä¼šå¯¼è‡´èµ„æºæ³„æ¼ã€‚&lt;/p>
&lt;p>æœ‰å¤šç§namespace:&lt;/p>
&lt;ul>
&lt;li>PID Namespaceï¼ˆCLONE_NEWPIDï¼‰ï¼šä¸åŒ namespace ä¸­çš„è¿›ç¨‹å¯ä»¥æ‹¥æœ‰ç›¸åŒçš„ PID&lt;/li>
&lt;li>Network Namespaceï¼ˆCLONE_NEWNETï¼‰ï¼šéš”ç¦»ç½‘ç»œæ ˆï¼ŒåŒ…æ‹¬ç½‘ç»œè®¾å¤‡ã€IP åœ°å€ã€ç«¯å£ã€è·¯ç”±è¡¨ä»¥åŠé˜²ç«å¢™è§„åˆ™&lt;/li>
&lt;li>Mount Namespaceï¼ˆCLONE_NEWNSï¼‰ï¼šéš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹&lt;/li>
&lt;li>User Namespaceï¼ˆCLONE_NEWUSERï¼‰ï¼šéš”ç¦»ç”¨æˆ·å’Œç»„ ID ç©ºé—´ï¼Œå…è®¸åŒä¸€ä¸ªç”¨æˆ·åœ¨ä¸åŒ namespace ä¸­æ‹¥æœ‰ä¸åŒçš„æƒé™&lt;/li>
&lt;li>&amp;hellip;&lt;/li>
&lt;/ul>
&lt;p>Docker å®¹å™¨é»˜è®¤ä¼šä½¿ç”¨ä»¥ä¸‹ namespaceï¼š&lt;/p>
&lt;ul>
&lt;li>PIDï¼šéš”ç¦»è¿›ç¨‹æ ‘ã€‚&lt;/li>
&lt;li>NETï¼šæä¾›ç‹¬ç«‹çš„ç½‘ç»œæ ˆã€‚&lt;/li>
&lt;li>IPCï¼šéš”ç¦»è¿›ç¨‹é—´é€šä¿¡ã€‚&lt;/li>
&lt;li>UTSï¼šè®¾ç½®ç‹¬ç«‹çš„ä¸»æœºåã€‚&lt;/li>
&lt;li>MOUNTï¼šéš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ã€‚&lt;/li>
&lt;li>USERï¼šç”¨äºæ˜ å°„å®¹å™¨å†…çš„ root ç”¨æˆ·åˆ°å®¿ä¸»æœºçš„æ™®é€šç”¨æˆ·ã€‚&lt;/li>
&lt;/ul>
&lt;p>æ¯ä¸ªè¿›ç¨‹çš„ namespace ä¿¡æ¯éƒ½å­˜å‚¨åœ¨/proc/[pid]/nsç›®å½•ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ls -l /proc/self/ns
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lrwxrwxrwx 1 user user 0 Jun 10 12:00 cgroup -&amp;gt; &amp;#39;cgroup:[4026531835]&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lrwxrwxrwx 1 user user 0 Jun 10 12:00 ipc -&amp;gt; &amp;#39;ipc:[4026531839]&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lrwxrwxrwx 1 user user 0 Jun 10 12:00 mnt -&amp;gt; &amp;#39;mnt:[4026531840]&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lrwxrwxrwx 1 user user 0 Jun 10 12:00 net -&amp;gt; &amp;#39;net:[4026531956]&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lrwxrwxrwx 1 user user 0 Jun 10 12:00 pid -&amp;gt; &amp;#39;pid:[4026531836]&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lrwxrwxrwx 1 user user 0 Jun 10 12:00 pid_for_children -&amp;gt; &amp;#39;pid:[4026531836]&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lrwxrwxrwx 1 user user 0 Jun 10 12:00 user -&amp;gt; &amp;#39;user:[4026531837]&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># lrwxrwxrwx 1 user user 0 Jun 10 12:00 uts -&amp;gt; &amp;#39;uts:[4026531838]&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å¦‚ä½•åˆ›å»º">å¦‚ä½•åˆ›å»ºï¼Ÿ&lt;/h3>
&lt;ol>
&lt;li>ä½¿ç”¨&lt;code>unshare&lt;/code>å‘½ä»¤åˆ›å»º namespaceï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åˆ›å»ºæ–°çš„æŒ‚è½½ç‚¹å’ŒPID namespaceï¼Œå¹¶åœ¨å…¶ä¸­å¯åŠ¨bash&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>unshare --mount --pid --fork bash
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åœ¨æ–°çš„namespaceä¸­æŸ¥çœ‹PID&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo $$ &lt;span style="color:#75715e"># è¾“å‡ºé€šå¸¸ä¸º1ï¼Œè¡¨ç¤ºå½“å‰bashæ˜¯æ–°namespaceä¸­çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŸ¥çœ‹å½“å‰namespaceä¸­çš„è¿›ç¨‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ps aux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>ä½¿ç”¨&lt;code>clone()&lt;/code>ç³»ç»Ÿè°ƒç”¨&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define _GNU_SOURCE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;sched.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;sys/wait.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å­è¿›ç¨‹æ‰§è¡Œçš„å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">child_func&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>arg) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åœ¨æ–°çš„UTS namespaceä¸­è®¾ç½®ä¸»æœºå
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> sethostname(&lt;span style="color:#e6db74">&amp;#34;container&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">9&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¾“å‡ºå½“å‰è¿›ç¨‹IDå’Œä¸»æœºå
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> printf(&lt;span style="color:#e6db74">&amp;#34;å­è¿›ç¨‹PID: %d&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, getpid());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> printf(&lt;span style="color:#e6db74">&amp;#34;ä¸»æœºå: %s&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;container&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡Œ/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> execlp(&lt;span style="color:#e6db74">&amp;#34;/bin/bash&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;bash&amp;#34;&lt;/span>, NULL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> STACK_SIZE &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">65536&lt;/span>; &lt;span style="color:#75715e">// ä¸ºå­è¿›ç¨‹åˆ†é…æ ˆç©ºé—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>stack &lt;span style="color:#f92672">=&lt;/span> malloc(STACK_SIZE);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#f92672">!&lt;/span>stack) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> perror(&lt;span style="color:#e6db74">&amp;#34;å†…å­˜åˆ†é…å¤±è´¥&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®æ ˆé¡¶ï¼ˆæ ˆæ˜¯å‘ä¸‹å¢é•¿çš„ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>stack_top &lt;span style="color:#f92672">=&lt;/span> stack &lt;span style="color:#f92672">+&lt;/span> STACK_SIZE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºæ–°çš„UTSå’ŒPID namespaceï¼Œå¹¶å¯åŠ¨å­è¿›ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> pid_t pid &lt;span style="color:#f92672">=&lt;/span> clone(child_func, stack_top, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CLONE_NEWUTS &lt;span style="color:#f92672">|&lt;/span> CLONE_NEWPID &lt;span style="color:#f92672">|&lt;/span> SIGCHLD, NULL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (pid &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> perror(&lt;span style="color:#e6db74">&amp;#34;cloneå¤±è´¥&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç­‰å¾…å­è¿›ç¨‹ç»“æŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> waitpid(pid, NULL, &lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> free(stack);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>ä½¿ç”¨&lt;code>setns()&lt;/code>åŠ å…¥ç°æœ‰ namespace&lt;br>
åŠ å…¥å¦ä¸€ä¸ªè¿›ç¨‹çš„ç½‘ç»œ namespaceï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define _GNU_SOURCE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;fcntl.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;sched.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰“å¼€ç›®æ ‡è¿›ç¨‹çš„ç½‘ç»œnamespaceæ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> fd &lt;span style="color:#f92672">=&lt;/span> open(&lt;span style="color:#e6db74">&amp;#34;/proc/1234/ns/net&amp;#34;&lt;/span>, O_RDONLY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (fd &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> perror(&lt;span style="color:#e6db74">&amp;#34;æ‰“å¼€namespaceæ–‡ä»¶å¤±è´¥&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åŠ å…¥ç›®æ ‡namespace
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (setns(fd, CLONE_NEWNET) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> perror(&lt;span style="color:#e6db74">&amp;#34;åŠ å…¥namespaceå¤±è´¥&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> close(fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰§è¡Œéœ€è¦åœ¨ç›®æ ‡namespaceä¸­è¿è¡Œçš„å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> execlp(&lt;span style="color:#e6db74">&amp;#34;ip&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;ip&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;addr&amp;#34;&lt;/span>, NULL);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>ä½¿ç”¨&lt;code>nsenter&lt;/code>å‘½ä»¤ï¼ˆç®€åŒ–ç‰ˆ&lt;code>setns()&lt;/code>ï¼‰&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo nsenter --target &lt;span style="color:#ae81ff">1234&lt;/span> --net ip addr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>[linux] TODO å®ˆæŠ¤è¿›ç¨‹ï¼Œsetsidï¼ŒLinuxä¸‰ä¸ªidï¼Œæƒé™</title><link>https://jekyulll.github.io/posts/linux-todo-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8Bsetsidlinux%E4%B8%89%E4%B8%AAid%E6%9D%83%E9%99%90/</link><pubDate>Tue, 29 Apr 2025 21:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-todo-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8Bsetsidlinux%E4%B8%89%E4%B8%AAid%E6%9D%83%E9%99%90/</guid><description>&lt;p>å¤ä¹ ï¼š&lt;a href="https://blog.csdn.net/JMW1407/article/details/108412836">ã€Linuxã€‘å®ˆæŠ¤è¿›ç¨‹ï¼ˆ Daemonï¼‰çš„å®šä¹‰ï¼Œä½œç”¨ï¼Œåˆ›å»ºæµç¨‹&lt;/a>ã€‚&lt;/p>
&lt;p>&lt;a href="https://blog.csdn.net/liaowenxiong/article/details/116401524">Linux å‘½ä»¤ä¹‹ &lt;code>locale&lt;/code> &amp;ndash; è®¾ç½®å’Œæ˜¾ç¤ºç¨‹åºè¿è¡Œçš„è¯­è¨€ç¯å¢ƒ&lt;/a>ã€‚&lt;/p>
&lt;blockquote>
&lt;p>ä½¿ç”¨ &lt;code>locale&lt;/code> å‘½ä»¤æ¥è®¾ç½®å’Œæ˜¾ç¤ºç¨‹åºè¿è¡Œçš„è¯­è¨€ç¯å¢ƒï¼Œ&lt;code>locale&lt;/code> ä¼šæ ¹æ®è®¡ç®—æœºç”¨æˆ·æ‰€ä½¿ç”¨çš„è¯­è¨€ï¼Œæ‰€åœ¨å›½å®¶æˆ–è€…åœ°åŒºï¼Œä»¥åŠå½“åœ°çš„æ–‡åŒ–ä¼ ç»Ÿå®šä¹‰ä¸€ä¸ªè½¯ä»¶è¿è¡Œæ—¶çš„è¯­è¨€ç¯å¢ƒã€‚&lt;br>
&lt;code>locale&lt;/code> ç”±ANSI Cæä¾›æ”¯æŒã€‚&lt;code>locale&lt;/code> çš„å‘½åè§„åˆ™ä¸º&lt;code>&amp;lt;è¯­è¨€&amp;gt;_&amp;lt;åœ°åŒº&amp;gt;.&amp;lt;å­—ç¬¦é›†ç¼–ç &amp;gt;&lt;/code>ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a href="https://blog.csdn.net/fmeng23/article/details/23115989">æ·±åˆ»ç†è§£â€”â€”real user id, effective user id, saved user id in Linux&lt;/a>ã€‚&lt;br>
&lt;a href="https://blog.csdn.net/ybxuwei/article/details/23563423">Linuxè¿›ç¨‹æƒé™çš„ç ”ç©¶â€”â€”real user id, effective user id, saved set-user-id&lt;/a>ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è°ƒç”¨setsidçš„è¿›ç¨‹ä¸æ˜¯ä¸€ä¸ªè¿›ç¨‹ç»„çš„ç»„é•¿ï¼Œæ­¤å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯æœŸã€‚&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>echo $UID
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>[linux] åœ¨weztermé‡Œä½¿ç”¨tmuxå®ç°history restore ä¿å­˜å†å²ä¼šè¯</title><link>https://jekyulll.github.io/posts/linux-tmux%E5%AE%9E%E7%8E%B0wezterm%E4%BF%9D%E5%AD%98%E4%BC%9A%E8%AF%9D/</link><pubDate>Tue, 29 Apr 2025 21:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-tmux%E5%AE%9E%E7%8E%B0wezterm%E4%BF%9D%E5%AD%98%E4%BC%9A%E8%AF%9D/</guid><description>&lt;hr>
&lt;p>çŸ¥ä¹é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/1961547067106259944&lt;/p>
&lt;p>weztermåœ¨æ‰“å¼€ä¸»è¿›ç¨‹ã€æˆ–è€…ctrl+alt+tæ–°å»ºtabçš„æ—¶å€™é»˜è®¤æ˜¯ç©ºçš„shellä¼šè¯ï¼Œæœ‰æ—¶å€™ä¸å¤Ÿæ–¹ä¾¿ã€‚&lt;/p>
&lt;p>tmuxå¯ä»¥è½»æ¾è§£å†³ç—›ç‚¹ï¼Œä½†æ˜¯å¦‚æœè®¾ç½®weztermçš„default_progä¸ºtmuxï¼ˆå³æ¯æ¬¡ä¼šè¯éƒ½å¯åŠ¨ï¼‰ï¼šåœ¨weztermé‡Œæ–°å»ºtabï¼Œä½ ä¼šå‘ç°å’Œä¹‹å‰å…±äº«åŒä¸€ä¸ªtmuxï¼Œç›¸å½“äºweztermè‡ªå¸¦çš„tabåŠŸèƒ½æ²¡ç”¨äº†ã€‚&lt;/p>
&lt;pre>&lt;code>config.default_prog = { &amp;quot;/usr/bin/tmux&amp;quot;, &amp;quot;new-session&amp;quot;, &amp;quot;-A&amp;quot;, &amp;quot;-s&amp;quot;, &amp;quot;main&amp;quot; }
&lt;/code>&lt;/pre>
&lt;p>äºæ˜¯ï¼šèƒ½å¦åªè®©weztermçš„ç¬¬ä¸€ä¸ªtabå§‹ç»ˆå¼€å¯ä¸€ä¸ªtmuxæ¥ä¿å­˜ä¼šè¯ï¼Œå…¶ä»–tabåˆ™ä½¿ç”¨é»˜è®¤çš„æ–°å»ºshellåŠŸèƒ½ï¼Ÿ&lt;/p>
&lt;p>å…·ä½“å®ç°ï¼š&lt;/p>
&lt;pre>&lt;code>-- ç¬¬ä¸€ä¸ªtabæ‰“å¼€tmuxï¼Œä¹‹åçš„ä¸ºç©ºçš„shell
local tmux_started = false
wezterm.on(&amp;quot;gui-startup&amp;quot;, function(cmd)
	-- å¯åŠ¨ wezterm æ—¶è‡ªåŠ¨æ‰“å¼€ä¸€ä¸ª window
	local tab, pane, window = wezterm.mux.spawn_window(cmd or {})
	if not tmux_started then
		tmux_started = true
		-- å¯åŠ¨ tmux
		pane:send_text(&amp;quot;tmux -u new-session -A -s main\n&amp;quot;)
	end
end)
&lt;/code>&lt;/pre>
&lt;p>åŠ åœ¨weztermé…ç½®åˆé€‚çš„ä½ç½®å³å¯ã€‚&lt;/p></description></item><item><title>Linux å®ˆæŠ¤è¿›ç¨‹</title><link>https://jekyulll.github.io/posts/linux-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/</link><pubDate>Tue, 29 Apr 2025 20:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/</guid><description>&lt;p>å¤ä¹ ï¼š&lt;a href="https://blog.csdn.net/JMW1407/article/details/108412836">ã€Linuxã€‘å®ˆæŠ¤è¿›ç¨‹ï¼ˆ Daemonï¼‰çš„å®šä¹‰ï¼Œä½œç”¨ï¼Œåˆ›å»ºæµç¨‹&lt;/a>ã€‚&lt;/p>
&lt;p>ç¼–å†™å®ˆæŠ¤è¿›ç¨‹çš„ä¸€èˆ¬æ­¥éª¤æ­¥éª¤ï¼š&lt;/p>
&lt;ol>
&lt;li>åœ¨çˆ¶è¿›ç¨‹ä¸­æ‰§è¡Œ&lt;code>fork&lt;/code>å¹¶&lt;code>exit&lt;/code>é€€å‡ºï¼›&lt;/li>
&lt;li>åœ¨å­è¿›ç¨‹ä¸­è°ƒç”¨&lt;code>setsid&lt;/code>å‡½æ•°åˆ›å»ºæ–°çš„ä¼šè¯ï¼›&lt;/li>
&lt;li>åœ¨å­è¿›ç¨‹ä¸­è°ƒç”¨&lt;code>chdir&lt;/code>å‡½æ•°ï¼Œè®©æ ¹ç›®å½•&lt;code>/&lt;/code>æˆä¸ºå­è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼›&lt;/li>
&lt;li>åœ¨å­è¿›ç¨‹ä¸­è°ƒç”¨&lt;code>umask&lt;/code>å‡½æ•°ï¼Œè®¾ç½®è¿›ç¨‹çš„&lt;code>umask&lt;/code>ä¸º&lt;code>0&lt;/code>ï¼›&lt;/li>
&lt;li>åœ¨å­è¿›ç¨‹ä¸­å…³é—­ä»»ä½•ä¸éœ€è¦çš„æ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/li>
&lt;/ol>
&lt;p>&lt;a href="https://blog.csdn.net/Change_Improve/article/details/106107317">Linuxâ€”umaskï¼ˆåˆ›å»ºæ–‡ä»¶æ—¶çš„æ©ç ï¼‰ç”¨æ³•è¯¦è§£&lt;/a>ã€‚&lt;/p>
&lt;p>&lt;a href="https://blog.csdn.net/fmeng23/article/details/23115989">æ·±åˆ»ç†è§£â€”â€”real user id, effective user id, saved user id in Linux&lt;/a>ã€‚&lt;br>
&lt;a href="https://blog.csdn.net/ybxuwei/article/details/23563423">Linuxè¿›ç¨‹æƒé™çš„ç ”ç©¶â€”â€”real user id, effective user id, saved set-user-id&lt;/a>ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è°ƒç”¨setsidçš„è¿›ç¨‹ä¸æ˜¯ä¸€ä¸ªè¿›ç¨‹ç»„çš„ç»„é•¿ï¼Œæ­¤å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯æœŸã€‚&lt;/p>
&lt;/blockquote></description></item><item><title>Linux çš„CPUä¿æŠ¤ç¯ï¼Œä¸‰ç¯å’Œé›¶ç¯</title><link>https://jekyulll.github.io/posts/linux-linux-%E7%9A%84cpu%E4%BF%9D%E6%8A%A4%E7%8E%AF%E4%B8%89%E7%8E%AF%E5%92%8C%E9%9B%B6%E7%8E%AF/</link><pubDate>Sun, 30 Mar 2025 04:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-linux-%E7%9A%84cpu%E4%BF%9D%E6%8A%A4%E7%8E%AF%E4%B8%89%E7%8E%AF%E5%92%8C%E9%9B%B6%E7%8E%AF/</guid><description>&lt;p>Linuxç³»ç»Ÿä¸­çš„â€œä¸‰ç¯â€å’Œâ€œé›¶ç¯â€æ¦‚å¿µæºè‡ªCPUçš„&lt;strong>ä¿æŠ¤ç¯&lt;/strong>ï¼ˆProtection Ringsï¼‰æœºåˆ¶ï¼Œæ˜¯æ“ä½œç³»ç»Ÿå®ç°æƒé™éš”ç¦»å’Œå®‰å…¨ä¿æŠ¤çš„æ ¸å¿ƒè®¾è®¡ã€‚&lt;/p>
&lt;p>x86ä¿æŠ¤ç¯çš„å®Œæ•´ç»“æ„ä¸ºå››å±‚ï¼Œä½†å®é™…ä»…Ring 0å’ŒRing 3è¢«å¹¿æ³›ä½¿ç”¨ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>é›¶ç¯&lt;/strong>ï¼ˆRing 0ï¼‰ï¼š
&lt;ul>
&lt;li>åˆç§°å†…æ ¸æ€ï¼Œæ˜¯CPUæƒé™æœ€é«˜çš„è¿è¡Œæ¨¡å¼ã€‚æ“ä½œç³»ç»Ÿå†…æ ¸è¿è¡Œäºæ­¤ç¯ï¼Œå¯ç›´æ¥è®¿é—®ç¡¬ä»¶èµ„æºï¼ˆå¦‚CPUã€å†…å­˜ã€I/Oè®¾å¤‡ï¼‰ï¼Œæ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼ˆå¦‚ä¿®æ”¹å†…å­˜æ˜ å°„ã€ä¸­æ–­å¤„ç†ç­‰ï¼‰ã€‚ä¾‹å¦‚ï¼ŒLinuxå†…æ ¸çš„è¿›ç¨‹è°ƒåº¦ã€å†…å­˜ç®¡ç†å’Œè®¾å¤‡é©±åŠ¨å‡åœ¨æ­¤å±‚çº§è¿è¡Œã€‚&lt;/li>
&lt;li>é›¶ç¯å¯ç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œè€Œä¸‰ç¯çš„ä»£ç è‹¥è¯•å›¾æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼ˆå¦‚ç›´æ¥è¯»å†™ç£ç›˜ï¼‰ï¼ŒCPUä¼šè§¦å‘å¼‚å¸¸ï¼ˆå¦‚General Protection Faultï¼‰ï¼Œå¼ºåˆ¶ç»ˆæ­¢éæ³•æ“ä½œã€‚è¿™ç§è®¾è®¡é¿å…äº†ç”¨æˆ·ç¨‹åºç ´åç³»ç»Ÿç¨³å®šæ€§ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ä¸‰ç¯&lt;/strong>ï¼ˆRing 3ï¼‰ï¼š
&lt;ul>
&lt;li>åˆç§°ç”¨æˆ·æ€ï¼Œæ˜¯æƒé™æœ€ä½çš„å±‚çº§ã€‚æ™®é€šåº”ç”¨ç¨‹åºè¿è¡Œäºæ­¤ç¯ï¼Œä»…èƒ½é€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼ˆSyscallï¼‰è¯·æ±‚å†…æ ¸æœåŠ¡ï¼Œæ— æ³•ç›´æ¥æ“ä½œç¡¬ä»¶ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯åŠ¨çš„æ–‡æœ¬ç¼–è¾‘å™¨ã€æµè§ˆå™¨ç­‰ç¨‹åºå‡å—æ­¤é™åˆ¶ã€‚&lt;/li>
&lt;li>ç”¨æˆ·ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨æˆ–ç¡¬ä»¶ä¸­æ–­ä»ä¸‰ç¯åˆ‡æ¢åˆ°é›¶ç¯ã€‚ä¾‹å¦‚ï¼Œå½“ç¨‹åºè°ƒç”¨&lt;code>open()&lt;/code>å‡½æ•°æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œä¼šè§¦å‘è½¯ä¸­æ–­ï¼ˆå¦‚&lt;code>int 0x80&lt;/code>æˆ–&lt;code>syscall&lt;/code>æŒ‡ä»¤ï¼‰ï¼Œå†…æ ¸æ¥ç®¡æ‰§è¡Œæ–‡ä»¶æ“ä½œï¼Œå®Œæˆåè¿”å›ç”¨æˆ·æ€ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;a href="https://blog.csdn.net/youyou1543724847/article/details/85048490">CPUçš„è¿è¡Œç¯, ç‰¹æƒçº§ä¸ä¿æŠ¤&lt;/a>ã€‚&lt;br>
&lt;a href="https://blog.csdn.net/farmwang/article/details/50094959">åŸæ–‡ â€”â€”CPUçš„è¿è¡Œç¯, ç‰¹æƒçº§ä¸ä¿æŠ¤&lt;/a>ã€‚&lt;br>
&lt;a href="https://blog.csdn.net/qq_26962739/article/details/133133574">Linuxå†…æ ¸å¼€å‘ä¹‹hookç³»ç»Ÿè°ƒç”¨&lt;/a>ã€‚&lt;br>
&lt;a href="https://www.cnblogs.com/onetrainee/p/11707130.html">ä¸‰ç¯è¿›å…¥é›¶ç¯çš„ç»†èŠ‚ï¼ˆKiFastCallEntryå‡½æ•°åˆ†æï¼‰&lt;/a>ã€‚&lt;br>
&lt;a href="https://blog.csdn.net/wxy_xx1/article/details/142953401">ç³»ç»Ÿè°ƒç”¨ä¹‹_KUSER_SHARED_DATA&lt;/a>ã€‚&lt;/p></description></item><item><title>forkå‡ºçš„å­è¿›ç¨‹æ˜¯å¦ç»§æ‰¿æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Ÿ</title><link>https://jekyulll.github.io/posts/linux-fork%E5%87%BA%E7%9A%84%E5%AD%90%E8%BF%9B%E7%A8%8B%E6%98%AF%E5%90%A6%E7%BB%A7%E6%89%BF%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E8%A1%A8/</link><pubDate>Sat, 29 Mar 2025 04:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-fork%E5%87%BA%E7%9A%84%E5%AD%90%E8%BF%9B%E7%A8%8B%E6%98%AF%E5%90%A6%E7%BB%A7%E6%89%BF%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E8%A1%A8/</guid><description>&lt;p>å½“é€šè¿‡ &lt;code>fork()&lt;/code> åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œå­è¿›ç¨‹ä¼šè·å¾—çˆ¶è¿›ç¨‹æ–‡ä»¶æè¿°ç¬¦è¡¨çš„&lt;u>å®Œæ•´å‰¯æœ¬&lt;/u>ã€‚è¿™æ„å‘³ç€å­è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­æ¯ä¸ªæ¡ç›®æŒ‡å‘çš„ ç³»ç»Ÿçº§æ–‡ä»¶è¡¨é¡¹ï¼ˆFile Table Entryï¼‰ä¸çˆ¶è¿›ç¨‹ç›¸åŒã€‚
çˆ¶å­è¿›ç¨‹å…±äº«æ–‡ä»¶è¡¨é¡¹ä¸­çš„æ–‡ä»¶åç§»é‡ï¼ˆOffsetï¼‰ã€æ‰“å¼€æ¨¡å¼ï¼ˆRead/Write Flagsï¼‰ã€æ–‡ä»¶çŠ¶æ€æ ‡å¿—ç­‰ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœçˆ¶è¿›ç¨‹å†™å…¥æ–‡ä»¶åç§»åŠ¨äº†åç§»é‡ï¼Œå­è¿›ç¨‹ä¼šä»æ–°çš„åç§»ä½ç½®ç»§ç»­æ“ä½œã€‚&lt;/p>
&lt;ul>
&lt;li>ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦è¡¨æœ¬èº«ï¼ˆå¦‚å…³é—­ &lt;code>fd&lt;/code>ï¼‰ï¼šå­è¿›ç¨‹çš„æ“ä½œä¸ä¼šå½±å“çˆ¶è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼Œå­è¿›ç¨‹å…³é—­ fd=3ï¼Œçˆ¶è¿›ç¨‹çš„ fd=3 ä»ç„¶æœ‰æ•ˆã€‚&lt;/li>
&lt;li>ä¿®æ”¹å…±äº«çš„æ–‡ä»¶è¡¨é¡¹ï¼ˆå¦‚åç§»é‡ã€çŠ¶æ€æ ‡å¿—ï¼‰ï¼šå­è¿›ç¨‹çš„æ“ä½œä¼šç›´æ¥å½±å“çˆ¶è¿›ç¨‹ï¼Œå› ä¸ºå®ƒä»¬å…±äº«åŒä¸€æ–‡ä»¶è¡¨é¡¹ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;a href="https://blog.csdn.net/DLUTBruceZhang/article/details/8802156">&lt;code>fork()&lt;/code>å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹ä¹‹é—´çš„æ–‡ä»¶æè¿°ç¬¦é—®é¢˜&lt;/a>ã€‚&lt;br>
&lt;a href="https://blog.csdn.net/m0_73209194/article/details/130165449">ã€Linuxã€‘è¿›ç¨‹é—´é€šä¿¡&lt;/a>ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ–‡ä»¶æè¿°ç¬¦ç›¸å½“äºä¸€ä¸ªé€»è¾‘å¥æŸ„ï¼Œè€Œ&lt;code>open&lt;/code>ï¼Œ&lt;code>close&lt;/code>ç­‰å‡½æ•°åˆ™æ˜¯å°†æ–‡ä»¶æˆ–è€…ç‰©ç†è®¾å¤‡ä¸å¥æŸ„ç›¸å…³è”ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>ä¸‰å¼ è¡¨ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ–‡ä»¶æè¿°ç¬¦è¡¨&lt;/strong>ï¼šç”¨æˆ·åŒºçš„ä¸€éƒ¨åˆ†ï¼Œé™¤éé€šè¿‡ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦çš„å‡½æ•°ï¼Œå¦åˆ™ç¨‹åºæ— æ³•å¯¹å…¶è¿›è¡Œè®¿é—®ã€‚å¯¹è¿›ç¨‹ä¸­æ¯ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼Œæ–‡ä»¶æè¿°ç¬¦è¡¨éƒ½åŒ…å«ä¸€ä¸ªæ¡ç›®ã€‚&lt;/li>
&lt;li>&lt;strong>ç³»ç»Ÿæ–‡ä»¶è¡¨&lt;/strong>ï¼šä¸ºç³»ç»Ÿä¸­æ‰€æœ‰çš„è¿›ç¨‹å…±äº«ã€‚å¯¹æ¯ä¸ªæ´»åŠ¨çš„open, å®ƒéƒ½åŒ…å«ä¸€ä¸ªæ¡ç›®ã€‚æ¯ä¸ªç³»ç»Ÿæ–‡ä»¶è¡¨çš„æ¡ç›®éƒ½åŒ…å«æ–‡ä»¶åç§»é‡ã€è®¿é—®æ¨¡å¼ï¼ˆè¯»ã€å†™ã€or è¯»-å†™ï¼‰ä»¥åŠæŒ‡å‘å®ƒçš„æ–‡ä»¶æè¿°ç¬¦è¡¨çš„æ¡ç›®è®¡æ•°ã€‚&lt;/li>
&lt;li>&lt;strong>å†…å­˜ç´¢å¼•èŠ‚ç‚¹è¡¨&lt;/strong>: å¯¹ç³»ç»Ÿä¸­çš„æ¯ä¸ªæ´»åŠ¨çš„æ–‡ä»¶ï¼ˆè¢«æŸä¸ªè¿›ç¨‹æ‰“å¼€äº†ï¼‰ï¼Œå†…å­˜ä¸­ç´¢å¼•èŠ‚ç‚¹è¡¨éƒ½åŒ…å«ä¸€ä¸ªæ¡ç›®ã€‚å‡ ä¸ªç³»ç»Ÿæ–‡ä»¶è¡¨æ¡ç›®å¯èƒ½å¯¹åº”äºåŒä¸€ä¸ªå†…å­˜ç´¢å¼•èŠ‚ç‚¹è¡¨ï¼ˆä¸åŒè¿›ç¨‹æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶ï¼‰ã€‚&lt;/li>
&lt;/ul></description></item><item><title>Linuxé‡Œforkå‡ºå­è¿›ç¨‹çš„æ—¶å€™ï¼Œå“ªäº›å†…å®¹æ˜¯å…±äº«çš„ï¼Ÿ</title><link>https://jekyulll.github.io/posts/linux-linux%E9%87%8Cfork%E5%87%BA%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%97%B6%E5%80%99%E5%93%AA%E4%BA%9B%E5%86%85%E5%AE%B9%E6%98%AF%E5%85%B1%E4%BA%AB%E7%9A%84/</link><pubDate>Thu, 27 Mar 2025 04:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-linux%E9%87%8Cfork%E5%87%BA%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%97%B6%E5%80%99%E5%93%AA%E4%BA%9B%E5%86%85%E5%AE%B9%E6%98%AF%E5%85%B1%E4%BA%AB%E7%9A%84/</guid><description>&lt;h3 id="ä¸€å…±äº«çš„å†…å®¹">&lt;strong>ä¸€ã€å…±äº«çš„å†…å®¹&lt;/strong>&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>æ–‡ä»¶æè¿°ç¬¦ä¸æ–‡ä»¶çŠ¶æ€&lt;/strong>&lt;br>
å­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹å·²æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼ŒåŒ…æ‹¬æ–‡ä»¶åç§»é‡ã€æ‰“å¼€æ¨¡å¼ï¼ˆå¦‚è¯»å†™æƒé™ï¼‰å’Œæ–‡ä»¶çŠ¶æ€æ ‡å¿—ï¼ˆå¦‚&lt;code>O_APPEND&lt;/code>ï¼‰ã€‚ä¾‹å¦‚ï¼Œè‹¥çˆ¶è¿›ç¨‹æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶å¹¶å†™å…¥æ•°æ®ï¼Œå­è¿›ç¨‹å¯é€šè¿‡ç›¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ç»§ç»­æ“ä½œï¼Œä¸”ä¸¤è€…çš„å†™å…¥ä½ç½®ï¼ˆåç§»é‡ï¼‰ä¼šç›¸äº’å½±å“ã€‚&lt;br>
â€¢ &lt;strong>ç¤ºä¾‹åœºæ™¯&lt;/strong>ï¼šçˆ¶è¿›ç¨‹å‘æ–‡ä»¶å†™å…¥â€œParentâ€ï¼Œå­è¿›ç¨‹å†™å…¥â€œChildâ€ï¼Œæœ€ç»ˆæ–‡ä»¶å†…å®¹ä¼šæŒ‰æ“ä½œé¡ºåºåˆå¹¶ï¼ˆå¦‚â€œParentChildâ€æˆ–â€œChildParentâ€ï¼‰ï¼Œå…·ä½“å–å†³äºè°ƒåº¦é¡ºåºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¿¡å·å¤„ç†è®¾ç½®&lt;/strong>&lt;br>
å­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼ˆå¦‚&lt;code>SIG_IGN&lt;/code>æˆ–è‡ªå®šä¹‰å¤„ç†ç¨‹åºï¼‰å’Œä¿¡å·å±è”½é›†ï¼ˆ&lt;code>sigprocmask&lt;/code>çš„è®¾ç½®ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç”¨æˆ·èº«ä»½ä¸ç¯å¢ƒå˜é‡&lt;/strong>&lt;br>
å­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹çš„ç”¨æˆ·IDã€ç»„IDã€ç¯å¢ƒå˜é‡ã€å½“å‰å·¥ä½œç›®å½•ç­‰èº«ä»½ä¿¡æ¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼‰çš„å†…å­˜åˆå§‹çŠ¶æ€&lt;/strong>&lt;br>
åœ¨æœªå‘ç”Ÿå†™å…¥æ“ä½œå‰ï¼Œçˆ¶å­è¿›ç¨‹çš„ä»£ç æ®µï¼ˆ&lt;code>.text&lt;/code>ï¼‰ã€æ•°æ®æ®µï¼ˆ&lt;code>.data&lt;/code>ã€&lt;code>.bss&lt;/code>ï¼‰ã€å †ã€æ ˆç­‰å†…å­˜åŒºåŸŸå…±äº«åŒä¸€ç‰©ç†å†…å­˜é¡µã€‚ä¸€æ—¦æŸä¸€æ–¹å°è¯•ä¿®æ”¹æ•°æ®ï¼Œåˆ™ä¼šè§¦å‘å†™æ—¶å¤åˆ¶ï¼Œç”Ÿæˆç‹¬ç«‹çš„å‰¯æœ¬ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ–‡ä»¶é”&lt;/strong>&lt;br>
é€šè¿‡&lt;code>fcntl&lt;/code>æˆ–&lt;code>flock&lt;/code>è®¾ç½®çš„æ–‡ä»¶é”ä¼šè¢«å­è¿›ç¨‹ç»§æ‰¿ï¼Œçˆ¶å­è¿›ç¨‹å¯¹åŒä¸€æ–‡ä»¶çš„é”å®šæ“ä½œä¼šç›¸äº’å½±å“ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="äºŒä¸å…±äº«çš„å†…å®¹">&lt;strong>äºŒã€ä¸å…±äº«çš„å†…å®¹&lt;/strong>&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>è¿›ç¨‹ç‹¬ç«‹å±æ€§&lt;/strong>&lt;br>
å­è¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è¿›ç¨‹IDï¼ˆPIDï¼‰ã€çˆ¶è¿›ç¨‹IDï¼ˆPPIDï¼‰ã€è¿è¡Œæ—¶é—´ç»Ÿè®¡ã€æœªå†³ä¿¡å·é˜Ÿåˆ—ç­‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„çº¿ç¨‹èµ„æº&lt;/strong>&lt;br>
è‹¥çˆ¶è¿›ç¨‹åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œå­è¿›ç¨‹ä»…å¤åˆ¶æ‰§è¡Œ&lt;code>fork()&lt;/code>çš„çº¿ç¨‹ï¼Œå…¶ä»–çº¿ç¨‹ä¸ä¼šè¢«ç»§æ‰¿ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç‹¬ç«‹çš„å†…å­˜ä¿®æ”¹&lt;/strong>&lt;br>
é€šè¿‡å†™æ—¶å¤åˆ¶æœºåˆ¶ï¼Œçˆ¶å­è¿›ç¨‹å¯¹å†…å­˜çš„ä¿®æ”¹ä¼šå„è‡ªç‹¬ç«‹ã€‚ä¾‹å¦‚ï¼Œå…¨å±€å˜é‡åˆå§‹å€¼ç›¸åŒï¼Œä½†ä¿®æ”¹åäº’ä¸å½±å“ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç‹¬ç«‹çš„æ–‡ä»¶æè¿°ç¬¦å…³é—­æ“ä½œ&lt;/strong>&lt;br>
å­è¿›ç¨‹å…³é—­æŸä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸ä¼šå½±å“çˆ¶è¿›ç¨‹çš„åŒåæè¿°ç¬¦ï¼Œåä¹‹äº¦ç„¶ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="ä¸‰å…³é”®æœºåˆ¶å†™æ—¶å¤åˆ¶cow">&lt;strong>ä¸‰ã€å…³é”®æœºåˆ¶ï¼šå†™æ—¶å¤åˆ¶ï¼ˆCOWï¼‰&lt;/strong>&lt;/h3>
&lt;p>å†…æ ¸é€šè¿‡å†™æ—¶å¤åˆ¶æŠ€æœ¯ä¼˜åŒ–æ€§èƒ½ï¼š&lt;br>
â€¢ &lt;strong>åŸç†&lt;/strong>ï¼š&lt;code>fork()&lt;/code>åï¼Œçˆ¶å­è¿›ç¨‹çš„é¡µè¡¨é¡¹æŒ‡å‘ç›¸åŒçš„ç‰©ç†å†…å­˜é¡µï¼Œå¹¶å°†è¿™äº›é¡µæ ‡è®°ä¸ºåªè¯»ã€‚å½“æŸä¸€è¿›ç¨‹å°è¯•å†™å…¥æ—¶ï¼Œè§¦å‘é¡µé”™è¯¯ï¼Œå†…æ ¸å¤åˆ¶è¯¥é¡µå¹¶ä¿®æ”¹æƒé™ä¸ºå¯å†™ã€‚&lt;br>
â€¢ &lt;strong>ä¼˜ç‚¹&lt;/strong>ï¼šé¿å…ä¸å¿…è¦çš„å†…å­˜å¤åˆ¶ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ã€‚&lt;/p>
&lt;hr>
&lt;h3 id="å››åº”ç”¨æ³¨æ„äº‹é¡¹">&lt;strong>å››ã€åº”ç”¨æ³¨æ„äº‹é¡¹&lt;/strong>&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>æ–‡ä»¶æ“ä½œåŒæ­¥&lt;/strong>ï¼šçˆ¶å­è¿›ç¨‹å¯¹åŒä¸€æ–‡ä»¶æè¿°ç¬¦çš„å¹¶å‘å†™å…¥éœ€é€šè¿‡é”ï¼ˆå¦‚&lt;code>flock()&lt;/code>ï¼‰æˆ–åŸå­æ“ä½œé¿å…ç«äº‰ã€‚&lt;/li>
&lt;li>&lt;strong>å†…å­˜å…±äº«é™åˆ¶&lt;/strong>ï¼šè‹¥éœ€ä¸»åŠ¨å…±äº«å†…å­˜ï¼Œéœ€ä½¿ç”¨&lt;code>mmap()&lt;/code>æˆ–å…±äº«å†…å­˜APIï¼ˆå¦‚&lt;code>shmget()&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>åƒµå°¸è¿›ç¨‹å¤„ç†&lt;/strong>ï¼šçˆ¶è¿›ç¨‹éœ€é€šè¿‡&lt;code>wait()&lt;/code>å›æ”¶å­è¿›ç¨‹èµ„æºï¼Œæˆ–æ³¨å†Œ&lt;code>SIGCHLD&lt;/code>ä¿¡å·å¤„ç†å‡½æ•°ã€‚&lt;/li>
&lt;/ol></description></item><item><title>ã€AIã€‘mmap å’Œé›¶æ‹·è´</title><link>https://jekyulll.github.io/posts/linux-mmap-%E5%92%8C%E9%9B%B6%E6%8B%B7%E8%B4%9D/</link><pubDate>Fri, 07 Mar 2025 20:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-mmap-%E5%92%8C%E9%9B%B6%E6%8B%B7%E8%B4%9D/</guid><description>&lt;p>mmapï¼ˆMemory Mappingï¼‰æ˜¯Unix/Linuxç³»ç»Ÿä¸­çš„ä¸€ç§é‡è¦æœºåˆ¶ï¼Œå®ƒå…è®¸å°†æ–‡ä»¶æˆ–è®¾å¤‡ç›´æ¥æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä»è€Œå°†æ–‡ä»¶æ“ä½œä¸å†…å­˜æ“ä½œé«˜æ•ˆç»“åˆã€‚ä»¥ä¸‹ä»æ ¸å¿ƒæœºåˆ¶ã€ä¸IOçš„å…³ç³»ã€ä¸å†…å­˜åˆ†é…çš„å…³ç³»ä¸‰ä¸ªæ–¹é¢è¯¦ç»†è§£æï¼š&lt;/p>
&lt;hr>
&lt;h3 id="ä¸€mmapçš„æ ¸å¿ƒæœºåˆ¶">ä¸€ã€mmapçš„æ ¸å¿ƒæœºåˆ¶&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>ç³»ç»Ÿè°ƒç”¨ä¸æ˜ å°„æ–¹å¼&lt;/strong>ï¼š
â€¢ &lt;strong>å‡½æ•°åŸå‹&lt;/strong>ï¼š&lt;code>void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset);&lt;/code>
â€¢ &lt;strong>å…³é”®å‚æ•°&lt;/strong>ï¼š
â—¦ &lt;code>prot&lt;/code>ï¼šæ§åˆ¶è¯»å†™æƒé™ï¼ˆå¦‚&lt;code>PROT_READ&lt;/code>ã€&lt;code>PROT_WRITE&lt;/code>ï¼‰ã€‚
â—¦ &lt;code>flags&lt;/code>ï¼šå†³å®šæ˜ å°„ç±»å‹ï¼ˆ&lt;code>MAP_SHARED&lt;/code>ã€&lt;code>MAP_PRIVATE&lt;/code>ã€&lt;code>MAP_ANONYMOUS&lt;/code>ï¼‰ã€‚
â€¢ &lt;strong>ä¸¤ç§ä¸»è¦æ˜ å°„&lt;/strong>ï¼š
â—¦ &lt;strong>æ–‡ä»¶æ˜ å°„&lt;/strong>ï¼šå°†æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ï¼Œä¿®æ”¹å¯åŒæ­¥åˆ°æ–‡ä»¶ï¼ˆ&lt;code>MAP_SHARED&lt;/code>ï¼‰æˆ–ä»…è¿›ç¨‹å¯è§ï¼ˆ&lt;code>MAP_PRIVATE&lt;/code>ï¼‰ã€‚
â—¦ &lt;strong>åŒ¿åæ˜ å°„&lt;/strong>ï¼šä¸å…³è”æ–‡ä»¶ï¼Œç”¨äºè¿›ç¨‹é—´å…±äº«å†…å­˜æˆ–åŠ¨æ€å†…å­˜åˆ†é…ï¼ˆ&lt;code>MAP_ANONYMOUS&lt;/code>ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å®ç°åŸç†&lt;/strong>ï¼š
â€¢ &lt;strong>è™šæ‹Ÿå†…å­˜ç®¡ç†&lt;/strong>ï¼šmmapåœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­åˆ’åˆ†ä¸€æ®µåŒºåŸŸï¼ˆé€šå¸¸ä½äºå †ä¸æ ˆä¹‹é—´ï¼‰ï¼Œé€šè¿‡é¡µè¡¨æ˜ å°„åˆ°ç‰©ç†å†…å­˜æˆ–æ–‡ä»¶çš„é¡µç¼“å­˜ã€‚
â€¢ &lt;strong>æŒ‰éœ€åŠ è½½ï¼ˆDemand Pagingï¼‰&lt;/strong>ï¼šè®¿é—®æ˜ å°„å†…å­˜æ—¶è§¦å‘ç¼ºé¡µä¸­æ–­ï¼Œå†…æ ¸è‡ªåŠ¨å°†æ–‡ä»¶æ•°æ®åŠ è½½åˆ°ç‰©ç†å†…å­˜ï¼Œå‡å°‘ä¸€æ¬¡æ€§åŠ è½½å¼€é”€ã€‚
â€¢ &lt;strong>åŒæ­¥æœºåˆ¶&lt;/strong>ï¼šä¿®æ”¹åçš„æ•°æ®ç”±å†…æ ¸å¼‚æ­¥å†™å›æ–‡ä»¶ï¼Œä¹Ÿå¯é€šè¿‡&lt;code>msync()&lt;/code>å¼ºåˆ¶åŒæ­¥ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="äºŒmmapä¸ioçš„å…³ç³»">äºŒã€mmapä¸IOçš„å…³ç³»&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>ä¼ ç»ŸIOçš„ç“¶é¢ˆ&lt;/strong>ï¼š
â€¢ &lt;strong>æ•°æ®æ‹·è´å¼€é”€&lt;/strong>ï¼š&lt;code>read()&lt;/code>/&lt;code>write()&lt;/code>éœ€è¦åœ¨å†…æ ¸ç¼“å†²åŒºï¼ˆé¡µç¼“å­˜ï¼‰ä¸ç”¨æˆ·ç©ºé—´ä¹‹é—´å¤åˆ¶æ•°æ®ï¼Œé¢‘ç¹ç³»ç»Ÿè°ƒç”¨å’Œæ‹·è´é™ä½æ€§èƒ½ã€‚
â€¢ &lt;strong>å°æ–‡ä»¶é—®é¢˜&lt;/strong>ï¼šå¤šæ¬¡ç³»ç»Ÿè°ƒç”¨å¯¹å°æ–‡ä»¶ä¸å‹å¥½ï¼Œå¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>mmapçš„ä¼˜åŠ¿&lt;/strong>ï¼š
â€¢ &lt;strong>é›¶æ‹·è´ï¼ˆZero-Copyï¼‰&lt;/strong>ï¼šç›´æ¥æ“ä½œæ˜ å°„å†…å­˜ï¼Œçœå»ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„æ•°æ®æ‹·è´ã€‚
â€¢ &lt;strong>å‡å°‘ç³»ç»Ÿè°ƒç”¨&lt;/strong>ï¼šé€šè¿‡å†…å­˜è®¿é—®éšå¼å®Œæˆæ–‡ä»¶è¯»å†™ï¼Œæ— éœ€æ˜¾å¼è°ƒç”¨&lt;code>read()&lt;/code>/&lt;code>write()&lt;/code>ã€‚
â€¢ &lt;strong>é«˜æ•ˆå¤§æ–‡ä»¶å¤„ç†&lt;/strong>ï¼šæŒ‰éœ€åŠ è½½ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§æ–‡ä»¶çš„å»¶è¿Ÿå’Œå†…å­˜æµªè´¹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ€§èƒ½å¯¹æ¯”&lt;/strong>ï¼š
â€¢ &lt;strong>é¡ºåºè®¿é—®&lt;/strong>ï¼šmmapä¸&lt;code>read()&lt;/code>æ€§èƒ½æ¥è¿‘ï¼Œä½†çœå»æ‹·è´æ—¶é—´ã€‚
â€¢ &lt;strong>éšæœºè®¿é—®&lt;/strong>ï¼šmmapæ˜¾è‘—ä¼˜äºä¼ ç»ŸIOï¼Œå‡å°‘å¤šæ¬¡&lt;code>lseek()&lt;/code>å’Œ&lt;code>read()&lt;/code>çš„å¼€é”€ã€‚
â€¢ &lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼šé€‚åˆé¢‘ç¹è¯»å†™æˆ–éœ€è¦éšæœºè®¿é—®çš„å¤§æ–‡ä»¶ï¼ˆå¦‚æ•°æ®åº“ã€å›¾åƒå¤„ç†ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="ä¸‰mmapä¸å†…å­˜åˆ†é…çš„å…³ç³»">ä¸‰ã€mmapä¸å†…å­˜åˆ†é…çš„å…³ç³»&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>åŠ¨æ€å†…å­˜åˆ†é…&lt;/strong>ï¼š
â€¢ &lt;strong>glibcçš„mallocç­–ç•¥&lt;/strong>ï¼š
â—¦ å°å—å†…å­˜ï¼ˆå¦‚&amp;lt;128KBï¼‰ä½¿ç”¨&lt;code>brk()&lt;/code>æ‰©å±•å †å†…å­˜ã€‚
â—¦ å¤§å—å†…å­˜ä½¿ç”¨&lt;code>mmap(MAP_ANONYMOUS)&lt;/code>ç‹¬ç«‹æ˜ å°„ï¼Œé¿å…å†…å­˜ç¢ç‰‡ã€‚
â€¢ &lt;strong>ä¼˜åŠ¿&lt;/strong>ï¼š&lt;code>mmap&lt;/code>åˆ†é…çš„å†…å­˜å¯ç‹¬ç«‹é‡Šæ”¾ï¼ˆ&lt;code>munmap()&lt;/code>ï¼‰ï¼Œè€Œ&lt;code>brk()&lt;/code>é‡Šæ”¾éœ€ä¾èµ–å †é¡¶å†…å­˜é‡Šæ”¾é¡ºåºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>åŒ¿åæ˜ å°„çš„åº”ç”¨&lt;/strong>ï¼š
â€¢ &lt;strong>è¿›ç¨‹é—´å…±äº«å†…å­˜&lt;/strong>ï¼šé€šè¿‡&lt;code>MAP_SHARED&lt;/code>æ ‡å¿—ï¼Œå¤šä¸ªè¿›ç¨‹å¯å…±äº«åŒä¸€ç‰©ç†å†…å­˜ï¼Œé«˜æ•ˆé€šä¿¡ã€‚
â€¢ &lt;strong>è‡ªå®šä¹‰å†…å­˜ç®¡ç†&lt;/strong>ï¼šæ›¿ä»£&lt;code>malloc&lt;/code>ï¼Œç”¨äºéœ€è¦ç²¾ç»†æ§åˆ¶çš„å¤§å†…å­˜åˆ†é…ï¼ˆå¦‚å†…å­˜æ± ï¼‰ã€‚&lt;/p></description></item><item><title>å†…æ ¸çš„ç”¨æˆ·æ€å’Œå†…æ ¸æ€</title><link>https://jekyulll.github.io/posts/linux-%E5%86%85%E6%A0%B8%E7%9A%84%E7%94%A8%E6%88%B7%E6%80%81%E5%92%8C%E5%86%85%E6%A0%B8%E6%80%81/</link><pubDate>Fri, 07 Mar 2025 20:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-%E5%86%85%E6%A0%B8%E7%9A%84%E7%94%A8%E6%88%B7%E6%80%81%E5%92%8C%E5%86%85%E6%A0%B8%E6%80%81/</guid><description>&lt;p>çº¿ç¨‹çš„ç®¡ç†å’Œè°ƒåº¦æ¶‰åŠç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åä½œï¼Œä¸åŒç¼–ç¨‹è¯­è¨€å’Œæ“ä½œç³»ç»Ÿå¯¹çº¿ç¨‹çš„å¤„ç†æ–¹å¼ä¹Ÿæœ‰æ‰€å·®å¼‚ã€‚&lt;/p>
&lt;hr>
&lt;h3 id="ä¸€çº¿ç¨‹æ¦‚å¿µçš„åŒé‡æ€§ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„äº¤ç»‡">ä¸€ã€çº¿ç¨‹æ¦‚å¿µçš„åŒé‡æ€§ï¼šç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„äº¤ç»‡&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>ç”¨æˆ·æ€çº¿ç¨‹ï¼ˆç”¨æˆ·çº§çº¿ç¨‹ï¼‰&lt;/strong>&lt;br>
ç”¨æˆ·æ€çº¿ç¨‹ç”±ç”¨æˆ·ç©ºé—´çš„çº¿ç¨‹åº“ç›´æ¥ç®¡ç†ï¼Œå†…æ ¸å¯¹å…¶æ— æ„ŸçŸ¥ã€‚è¿™ç±»çº¿ç¨‹çš„åˆ›å»ºã€è°ƒåº¦ã€åŒæ­¥ç­‰æ“ä½œå®Œå…¨åœ¨ç”¨æˆ·ç©ºé—´å®Œæˆï¼Œæ— éœ€å†…æ ¸ä»‹å…¥ã€‚&lt;br>
å­˜åœ¨æ˜æ˜¾å±€é™æ€§ï¼š&lt;br>
â€¢ &lt;strong>é˜»å¡é—®é¢˜&lt;/strong>ï¼šè‹¥ä¸€ä¸ªç”¨æˆ·æ€çº¿ç¨‹å› ç³»ç»Ÿè°ƒç”¨é˜»å¡ï¼ˆå¦‚I/Oæ“ä½œï¼‰ï¼Œæ•´ä¸ªè¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼›
â€¢ &lt;strong>å¤šæ ¸åˆ©ç”¨ç‡ä½&lt;/strong>ï¼šå†…æ ¸æ— æ³•å°†ç”¨æˆ·æ€çº¿ç¨‹è°ƒåº¦åˆ°å¤šä¸ªCPUæ ¸å¿ƒä¸Šè¿è¡Œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å†…æ ¸æ€çº¿ç¨‹ï¼ˆå†…æ ¸çº§çº¿ç¨‹ï¼‰&lt;/strong>&lt;br>
å†…æ ¸ç›´æ¥ç®¡ç†çº¿ç¨‹çš„åˆ›å»ºã€è°ƒåº¦å’Œé”€æ¯ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼ˆå¦‚Linuxçš„è½»é‡çº§è¿›ç¨‹LWPï¼‰ã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;em>è½»é‡çº§è¿›ç¨‹&lt;/em>ï¼ˆLight Weight Process, LWPï¼‰ä½œä¸ºç”¨æˆ·çº¿ç¨‹ä¸å†…æ ¸çº¿ç¨‹çš„æ¡¥æ¢ï¼Œè´Ÿè´£å¤„ç†ç³»ç»Ÿè°ƒç”¨ã€èµ„æºåˆ†é…å’ŒCPUæ˜ å°„ã€‚å½“ç”¨æˆ·çº¿ç¨‹å‘èµ·ç³»ç»Ÿè°ƒç”¨æ—¶ï¼ŒLWPæ¥ç®¡è¯·æ±‚ï¼Œé¿å…å› å•ä¸ªç”¨æˆ·çº¿ç¨‹é˜»å¡å¯¼è‡´æ•´ä¸ªè¿›ç¨‹æŒ‚èµ·ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>â€¢ &lt;strong>å¤šæ ¸å¹¶è¡Œ&lt;/strong>ï¼šå†…æ ¸å¯å°†ä¸åŒçº¿ç¨‹åˆ†é…åˆ°å¤šä¸ªCPUæ ¸å¿ƒï¼›
â€¢ &lt;strong>ç‹¬ç«‹é˜»å¡&lt;/strong>ï¼šå•ä¸ªçº¿ç¨‹é˜»å¡ä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹ï¼›
â€¢ &lt;strong>åˆ‡æ¢å¼€é”€å¤§&lt;/strong>ï¼šçº¿ç¨‹åˆ‡æ¢éœ€é€šè¿‡å†…æ ¸æ€ï¼Œæ¶‰åŠç”¨æˆ·æ ˆå’Œå†…æ ¸æ ˆçš„åˆ‡æ¢ã€å¯„å­˜å™¨ä¿å­˜ä¸æ¢å¤ç­‰æ“ä½œã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="äºŒå†…æ ¸å¦‚ä½•å¤„ç†çº¿ç¨‹">äºŒã€å†…æ ¸å¦‚ä½•å¤„ç†çº¿ç¨‹ï¼Ÿ&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>çº¿ç¨‹æ¨¡å‹çš„æ˜ å°„å…³ç³»&lt;/strong>&lt;br>
ç°ä»£æ“ä½œç³»ç»Ÿï¼ˆå¦‚Linuxï¼‰é€šå¸¸é‡‡ç”¨&lt;strong>æ··åˆå‹çº¿ç¨‹æ¨¡å‹&lt;/strong>ã€‚å†…æ ¸é€šè¿‡ä»¥ä¸‹æœºåˆ¶ç®¡ç†çº¿ç¨‹ï¼š&lt;br>
â€¢ &lt;strong>TCBï¼ˆçº¿ç¨‹æ§åˆ¶å—ï¼‰&lt;/strong>ï¼šå­˜å‚¨çº¿ç¨‹çš„å†…æ ¸æ ˆæŒ‡é’ˆã€çŠ¶æ€ã€ä¼˜å…ˆçº§ç­‰ä¿¡æ¯ï¼ˆè¿›ç¨‹æ§åˆ¶å—æ˜¯PCBï¼‰ï¼›
â€¢ &lt;strong>è°ƒåº¦å™¨&lt;/strong>ï¼šåŸºäºæ—¶é—´ç‰‡è½®è½¬æˆ–ä¼˜å…ˆçº§ç­–ç•¥åˆ†é…CPUèµ„æºï¼Œè§¦å‘ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;em>æ··åˆå‹çº¿ç¨‹æ¨¡å‹&lt;/em>ï¼ˆHybrid Thread Modelï¼‰æ˜¯ä¸€ç§ç»“åˆç”¨æˆ·çº§çº¿ç¨‹ï¼ˆULTï¼‰å’Œå†…æ ¸çº§çº¿ç¨‹ï¼ˆKLTï¼‰ä¼˜åŠ¿çš„çº¿ç¨‹å®ç°æ–¹å¼ã€‚é€šè¿‡N:Mæ˜ å°„å®ç°ç”¨æˆ·çº¿ç¨‹ä¸å†…æ ¸çº¿ç¨‹çš„å…³è”ï¼Œå³å¤šä¸ªç”¨æˆ·çº¿ç¨‹ï¼ˆNï¼‰åŠ¨æ€ç»‘å®šåˆ°å°‘é‡å†…æ ¸çº¿ç¨‹ï¼ˆMï¼‰ã€‚&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢æœºåˆ¶&lt;/strong>&lt;br>
å½“çº¿ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ã€å‘ç”Ÿå¼‚å¸¸æˆ–ä¸­æ–­æ—¶ï¼Œä¼šè§¦å‘ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ï¼š&lt;br>
â€¢ &lt;strong>ç³»ç»Ÿè°ƒç”¨æµç¨‹&lt;/strong>ï¼šç”¨æˆ·çº¿ç¨‹é€šè¿‡ä¸­æ–­ï¼ˆå¦‚Linuxçš„&lt;code>int 80h&lt;/code>ï¼‰è¿›å…¥å†…æ ¸æ€ï¼Œå†…æ ¸å®Œæˆæ“ä½œåæ¢å¤ç”¨æˆ·æ€æ‰§è¡Œï¼›
â€¢ &lt;strong>ä¸Šä¸‹æ–‡ä¿å­˜&lt;/strong>ï¼šåˆ‡æ¢æ—¶éœ€è¦ä¿å­˜ç”¨æˆ·æ ˆçš„å¯„å­˜å™¨çŠ¶æ€ï¼ˆå¦‚ç¨‹åºè®¡æ•°å™¨ã€æ ˆæŒ‡é’ˆï¼‰åˆ°å†…å­˜ï¼Œå¹¶åŠ è½½å†…æ ¸æ ˆä¿¡æ¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ€§èƒ½ä¼˜åŒ–ç­–ç•¥&lt;/strong>&lt;br>
å†…æ ¸é€šè¿‡ä»¥ä¸‹æ–¹å¼å‡å°‘åˆ‡æ¢å¼€é”€ï¼š&lt;br>
â€¢ &lt;strong>é¿å…é¢‘ç¹åˆ‡æ¢&lt;/strong>ï¼šé‡‡ç”¨æ— é”ç¼–ç¨‹ã€CASç®—æ³•ç­‰å‡å°‘çº¿ç¨‹ç«äº‰ï¼›
â€¢ &lt;strong>è½»é‡çº§è¿›ç¨‹ï¼ˆLWPï¼‰&lt;/strong>ï¼šé€šè¿‡çº¿ç¨‹æ± å¤ç”¨å†…æ ¸çº¿ç¨‹ï¼Œé™ä½åˆ›å»ºé”€æ¯æˆæœ¬ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="ä¸‰è¯­è¨€æ¡ˆä¾‹">ä¸‰ã€è¯­è¨€æ¡ˆä¾‹&lt;/h3>
&lt;p>Javaçº¿ç¨‹åœ¨JDK1.2ä¹‹åé‡‡ç”¨&lt;em>1:1æ¨¡å‹&lt;/em>ï¼Œæ¯ä¸ªJavaçº¿ç¨‹å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ã€‚
æ”¯æŒå¤šæ ¸å¹¶è¡Œã€é¿å…å•çº¿ç¨‹é˜»å¡å½±å“æ•´ä½“è¿›ç¨‹ï¼›çº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢éœ€è¦å†…æ ¸ä»‹å…¥ã€‚&lt;/p>
&lt;p>C++11åŠä¹‹åçš„æ ‡å‡†åº“ï¼ˆå¦‚&lt;code>&amp;lt;thread&amp;gt;&lt;/code>ï¼‰é€šè¿‡&lt;code>std::thread&lt;/code>ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼ˆå¦‚Linuxçš„POSIXçº¿ç¨‹æˆ–Windowsçº¿ç¨‹ï¼‰ï¼Œé‡‡ç”¨&lt;em>1:1çº¿ç¨‹æ¨¡å‹&lt;/em>ã€‚&lt;/p>
&lt;p>Goæœªç›´æ¥ä½¿ç”¨æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œè€Œæ˜¯é€šè¿‡Goroutineå®ç°å¹¶å‘ã€‚Goroutineç”±Goè¿è¡Œæ—¶è°ƒåº¦ï¼Œé‡‡ç”¨M:Nçº¿ç¨‹æ¨¡å‹â€‹ï¼ˆå¤šä¸ªGoroutineæ˜ å°„åˆ°å°‘é‡å†…æ ¸çº¿ç¨‹ï¼‰ï¼Œç”±è¿è¡Œæ—¶åŠ¨æ€åˆ†é…CPUæ—¶é—´ç‰‡ã€‚&lt;/p></description></item><item><title>è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹çš„èµ„æºæ¶ˆè€—ç®€è¿°</title><link>https://jekyulll.github.io/posts/linux-%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E5%8D%8F%E7%A8%8B%E7%9A%84%E8%B5%84%E6%BA%90%E6%B6%88%E8%80%97%E7%AE%80%E8%BF%B0/</link><pubDate>Fri, 07 Mar 2025 20:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E5%8D%8F%E7%A8%8B%E7%9A%84%E8%B5%84%E6%BA%90%E6%B6%88%E8%80%97%E7%AE%80%E8%BF%B0/</guid><description>&lt;p>&lt;strong>ä¸€ã€çº¿ç¨‹åˆ‡æ¢ vs è¿›ç¨‹åˆ‡æ¢&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>åœ°å€ç©ºé—´ä¸é¡µè¡¨&lt;/strong>&lt;br>
è¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´å’Œé¡µè¡¨ï¼Œåˆ‡æ¢è¿›ç¨‹æ—¶éœ€æ›´æ–°é¡µè¡¨å¹¶åˆ·æ–° &lt;strong>TLBï¼ˆåœ°å€è½¬æ¢ç¼“å­˜ï¼‰&lt;/strong>ï¼Œå¯¼è‡´å†…å­˜è®¿é—®é€Ÿåº¦ä¸‹é™ã€‚è€Œçº¿ç¨‹å…±äº«è¿›ç¨‹çš„åœ°å€ç©ºé—´å’Œé¡µè¡¨ï¼Œåˆ‡æ¢æ—¶æ— éœ€æ­¤æ“ä½œï¼ŒTLB ç¼“å­˜ä¿æŒæœ‰æ•ˆã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¸Šä¸‹æ–‡ä¿å­˜çš„å†…å®¹&lt;/strong>&lt;br>
â€¢ &lt;strong>è¿›ç¨‹åˆ‡æ¢&lt;/strong>ï¼šéœ€ä¿å­˜å®Œæ•´çš„ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨ã€æ ˆæŒ‡é’ˆã€å†…å­˜æ˜ å°„ã€æ–‡ä»¶æè¿°ç¬¦ç­‰ã€‚&lt;br>
â€¢ &lt;strong>çº¿ç¨‹åˆ‡æ¢&lt;/strong>ï¼šä»…éœ€ä¿å­˜çº¿ç¨‹ç§æœ‰çš„å¯„å­˜å™¨ã€æ ˆå’Œç¨‹åºè®¡æ•°å™¨ï¼Œå…±äº«èµ„æºï¼ˆå¦‚ä»£ç æ®µã€æ–‡ä»¶ï¼‰æ— éœ€å¤„ç†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç¼“å­˜åˆ©ç”¨ç‡&lt;/strong>&lt;br>
è¿›ç¨‹åˆ‡æ¢ä¼šå¯¼è‡´ CPU ç¼“å­˜ï¼ˆå¦‚ L1/L2/L3ï¼‰å¤±æ•ˆï¼Œéœ€é‡æ–°åŠ è½½æ•°æ®ï¼Œé™ä½æ€§èƒ½ã€‚çº¿ç¨‹åˆ‡æ¢æ—¶ï¼Œç¼“å­˜å› å…±äº«åœ°å€ç©ºé—´ä»æœ‰æ•ˆï¼Œå‡å°‘äº†æ•°æ®é‡è½½çš„å¼€é”€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>èµ„æºåˆ†é…&lt;/strong>&lt;br>
è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼ˆå¦‚å†…å­˜ã€æ–‡ä»¶ï¼‰ï¼Œåˆ‡æ¢æ—¶éœ€é‡æ–°åˆ†é…èµ„æºï¼›çº¿ç¨‹å…±äº«è¿›ç¨‹èµ„æºï¼Œåˆ‡æ¢ä»…æ¶‰åŠæ‰§è¡Œæµè°ƒåº¦ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>äºŒã€åç¨‹åˆ‡æ¢ vs çº¿ç¨‹åˆ‡æ¢&lt;/strong>&lt;/p>
&lt;p>åç¨‹çš„åˆ‡æ¢å¼€é”€æ›´å°ï¼ŒåŸå› åœ¨äºå…¶ &lt;strong>ç”¨æˆ·æ€è°ƒåº¦&lt;/strong> å’Œ &lt;strong>è½»é‡çº§è®¾è®¡&lt;/strong>ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>ç”¨æˆ·æ€è°ƒåº¦&lt;/strong>&lt;br>
åç¨‹åˆ‡æ¢å®Œå…¨ç”±ç”¨æˆ·æ€ä»£ç æ§åˆ¶ï¼Œæ— éœ€é™·å…¥å†…æ ¸æ€ï¼Œé¿å…äº† &lt;strong>ç”¨æˆ·æ€-å†…æ ¸æ€åˆ‡æ¢&lt;/strong> çš„å¼€é”€ã€‚è€Œçº¿ç¨‹åˆ‡æ¢éœ€æ“ä½œç³»ç»Ÿä»‹å…¥ï¼Œæ¶‰åŠæ¨¡å¼åˆ‡æ¢å’Œå†…æ ¸è°ƒåº¦ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¸Šä¸‹æ–‡ä¿¡æ¯æ›´å°‘&lt;/strong>&lt;br>
åç¨‹åªéœ€ä¿å­˜å°‘é‡å¯„å­˜å™¨ï¼ˆå¦‚ PCã€SPï¼‰å’Œæ ˆæŒ‡é’ˆï¼Œä¸”æ ˆç©ºé—´é€šå¸¸ä»…éœ€ KB çº§åˆ«ï¼ˆçº¿ç¨‹æ ˆä¸º MB çº§åˆ«ï¼‰ã€‚ä¾‹å¦‚ï¼ŒGo åç¨‹çš„åˆå§‹æ ˆä»… 2KBï¼Œè€Œ Java çº¿ç¨‹é»˜è®¤ä¸º 1MBã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>éé˜»å¡ä¸åä½œå¼è°ƒåº¦&lt;/strong>&lt;br>
åç¨‹é€šè¿‡ä¸»åŠ¨è®©å‡ºï¼ˆå¦‚ &lt;code>yield&lt;/code> æˆ– &lt;code>await&lt;/code>ï¼‰å®ç°åä½œå¼è°ƒåº¦ï¼Œå‡å°‘æŠ¢å å¼è°ƒåº¦çš„ç«äº‰å’Œé”éœ€æ±‚ã€‚çº¿ç¨‹é€šå¸¸ä¾èµ–æ“ä½œç³»ç»Ÿçš„æŠ¢å å¼è°ƒåº¦ï¼Œå¯èƒ½å› é¢‘ç¹åˆ‡æ¢å¯¼è‡´æ€§èƒ½æŸè€—ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å†…å­˜ä¸å¹¶å‘æ•ˆç‡&lt;/strong>&lt;br>
å•çº¿ç¨‹å¯è¿è¡Œæ•°ä¸‡åç¨‹ï¼ˆå¦‚ Go çš„ Goroutineï¼‰ï¼Œè€ŒåŒç­‰æ•°é‡çº¿ç¨‹ä¼šå› å†…å­˜å’Œè°ƒåº¦å¼€é”€è¿‡å¤§è€Œå´©æºƒã€‚åç¨‹çš„è½»é‡çº§ç‰¹æ€§å°¤å…¶é€‚åˆé«˜å¹¶å‘ I/O å¯†é›†å‹ä»»åŠ¡ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>&lt;strong>ç»´åº¦&lt;/strong>&lt;/th>
 &lt;th>&lt;strong>è¿›ç¨‹åˆ‡æ¢&lt;/strong>&lt;/th>
 &lt;th>&lt;strong>çº¿ç¨‹åˆ‡æ¢&lt;/strong>&lt;/th>
 &lt;th>&lt;strong>åç¨‹åˆ‡æ¢&lt;/strong>&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>&lt;strong>åœ°å€ç©ºé—´&lt;/strong>&lt;/td>
 &lt;td>åˆ‡æ¢ï¼ˆç‹¬ç«‹ï¼‰&lt;/td>
 &lt;td>ä¸åˆ‡æ¢ï¼ˆå…±äº«ï¼‰&lt;/td>
 &lt;td>ä¸åˆ‡æ¢ï¼ˆå…±äº«ï¼‰&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>ä¸Šä¸‹æ–‡å¤§å°&lt;/strong>&lt;/td>
 &lt;td>å¤§ï¼ˆå«å…¨éƒ¨èµ„æºï¼‰&lt;/td>
 &lt;td>è¾ƒå°ï¼ˆä»…å¯„å­˜å™¨ï¼‰&lt;/td>
 &lt;td>æå°ï¼ˆä»…å…³é”®å¯„å­˜å™¨ï¼‰&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>è°ƒåº¦æ¨¡å¼&lt;/strong>&lt;/td>
 &lt;td>å†…æ ¸æŠ¢å å¼&lt;/td>
 &lt;td>å†…æ ¸æŠ¢å å¼&lt;/td>
 &lt;td>ç”¨æˆ·åä½œå¼&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>å†…å­˜å¼€é”€&lt;/strong>&lt;/td>
 &lt;td>é«˜ï¼ˆç‹¬ç«‹èµ„æºï¼‰&lt;/td>
 &lt;td>ä¸­ï¼ˆå…±äº«èµ„æºï¼‰&lt;/td>
 &lt;td>æä½ï¼ˆKB çº§æ ˆï¼‰&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;p>&lt;u>çº¿ç¨‹é€šè¿‡å…±äº«èµ„æºå‡å°‘å¼€é”€ï¼Œåç¨‹é€šè¿‡ç”¨æˆ·æ€è½»é‡çº§è°ƒåº¦è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œä¸¤è€…å‡é€šè¿‡å‡å°‘å†…æ ¸å‚ä¸å’Œèµ„æºå¤ç”¨æ¥æå‡æ€§èƒ½&lt;/u>&amp;gt;ã€‚&lt;/p></description></item><item><title>åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œä¿®æ”¹å¹¶ä¸”è¦†ç›–è¯¥äºŒè¿›åˆ¶æ–‡ä»¶ä¼šå¦‚ä½•ï¼Ÿ</title><link>https://jekyulll.github.io/posts/linux-%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E6%97%B6%E5%80%99%E4%BF%AE%E6%94%B9%E5%B9%B6%E4%B8%94%E8%A6%86%E7%9B%96%E8%AF%A5%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E4%BC%9A%E5%A6%82%E4%BD%95/</link><pubDate>Thu, 06 Mar 2025 18:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E6%97%B6%E5%80%99%E4%BF%AE%E6%94%B9%E5%B9%B6%E4%B8%94%E8%A6%86%E7%9B%96%E8%AF%A5%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E4%BC%9A%E5%A6%82%E4%BD%95/</guid><description>&lt;blockquote>
&lt;p>Linuxä¸Šæœ‰ä¸ªäºŒè¿›åˆ¶ç¨‹åºä¸€ç›´åœ¨è¿è¡Œï¼Œä¿®æ”¹ä»£ç åé‡æ–°ç¼–è¯‘æŠŠåŸæ¥çš„äºŒè¿›åˆ¶ç¨‹åºè¦†ç›–äº†ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ
è¯¥é—®é¢˜æ¥è‡ªä¸€é“å¤©ç¾åå°å¼€å‘é¢è¯•é¢˜ï¼š&lt;a href="https://zhuanlan.zhihu.com/p/677307438">å¤©ç¾ä¸€é¢ åå°å¼€å‘ï¼ˆå‡‰ï¼‰ - ç‰›å®¢é¢ç»çš„æ–‡ç«  - çŸ¥ä¹&lt;/a>ã€‚æ­¤å¤„å°è¯•è¿›è¡Œå›ç­”ã€‚&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;p>ç¬¬ä¸€æƒ³æ³•ä¸€èˆ¬æ˜¯ï¼šâ€œåŸç¨‹åºè¢«æ“ä½œç³»ç»ŸåŠ è½½è¿›å†…å­˜ï¼Œä¸ä¼šå—åˆ°å½±å“ã€‚â€&lt;br>
ç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„&lt;code>inode&lt;/code>æŒ‡å‘æ–°æ–‡ä»¶ï¼Œè€Œæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä»ä¼šç»§ç»­ä½¿ç”¨æ—§çš„&lt;code>inode&lt;/code>å¯¹åº”çš„ä»£ç æ®µã€‚&lt;/p>
&lt;p>ä½†å®é™…ä¸Šæ‹“å±•åˆ°ä¸€ä¸ªé—®é¢˜ï¼šâ€œäºŒè¿›åˆ¶æ–‡ä»¶ä¼šå…¨éƒ¨åŠ è½½åˆ°å†…å­˜å—ï¼Ÿâ€&lt;/p>
&lt;p>ELFäºŒè¿›åˆ¶æ–‡ä»¶åœ¨åŠ è½½æ—¶ï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸é‡‡ç”¨æŒ‰éœ€åˆ†é¡µçš„æœºåˆ¶ï¼Œåªå°†å½“å‰éœ€è¦çš„éƒ¨åˆ†åŠ è½½åˆ°ç‰©ç†å†…å­˜ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ–‡ä»¶ã€‚è™šæ‹Ÿå†…å­˜æ˜ å°„å…è®¸æ–‡ä»¶çš„éƒ¨åˆ†å†…å®¹é©»ç•™åœ¨ç£ç›˜ï¼Œç›´åˆ°è¢«è®¿é—®æ—¶æ‰è°ƒå…¥å†…å­˜ã€‚&lt;br>
åŒæ—¶ï¼ŒåŠ¨æ€é“¾æ¥åº“çš„å»¶è¿ŸåŠ è½½å’Œå†…å­˜æ˜ å°„æ–‡ä»¶æŠ€æœ¯ï¼ˆ&lt;code>mmap&lt;/code>ï¼‰ä¹Ÿå¸®åŠ©å‡å°‘å®é™…å†…å­˜å ç”¨ã€‚å› æ­¤ï¼Œå¦‚æœäºŒè¿›åˆ¶æ–‡ä»¶å¾ˆå¤§ï¼Œä¸ä¼šå…¨éƒ¨åŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œè€Œæ˜¯æŒ‰éœ€åŠ è½½ï¼Œåˆ©ç”¨è™šæ‹Ÿå†…å­˜ç®¡ç†æŠ€æœ¯ä¼˜åŒ–èµ„æºä½¿ç”¨ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼šçœŸçš„ä¼šåœ¨è¿è¡Œæ—¶åŠ è½½æ–°çš„å†…å®¹å—ï¼Ÿ&lt;/p>
&lt;p>ELFæ–‡ä»¶åœ¨å¯åŠ¨æ—¶å¦‚ä½•å†³å®šå“ªäº›å†…å®¹åŠ è½½åˆ°å†…å­˜ï¼Ÿä¸»è¦ä¾èµ–äºå…¶&lt;strong>ç¨‹åºå¤´è¡¨&lt;/strong>ï¼ˆProgram Header Tableï¼‰â€‹ä¸­å®šä¹‰çš„æ®µï¼ˆSegmentï¼‰ä¿¡æ¯ã€‚ç¨‹åºå¤´è¡¨ç”±å¤šä¸ª&lt;code>Elf64_Phdr&lt;/code>ç»“æ„ä½“ç»„æˆï¼Œæ¯ä¸ªç»“æ„ä½“æè¿°äº†ä¸€ä¸ªéœ€è¦åŠ è½½åˆ°å†…å­˜çš„æ®µï¼ˆå¦‚ä»£ç æ®µã€æ•°æ®æ®µã€åŠ¨æ€é“¾æ¥ä¿¡æ¯æ®µç­‰ï¼‰ã€‚è¿™äº›æ®µé€šå¸¸åŒ…å«å¤šä¸ª&lt;em>èŠ‚&lt;/em>ï¼ˆSectionï¼‰çš„é›†åˆã€‚&lt;/p>
&lt;p>è¦†ç›–åŸæ–‡ä»¶åï¼Œæ—§æ–‡ä»¶çš„ç£ç›˜ç©ºé—´ä¸ä¼šè¢«ç«‹å³é‡Šæ”¾ï¼Œéœ€ç­‰å¾…æ‰€æœ‰å…³è”è¿›ç¨‹ç»“æŸåæ‰èƒ½å›æ”¶ï¼ˆé€šè¿‡&lt;code>lsof&lt;/code>å¯æŸ¥çœ‹å ç”¨è¿›ç¨‹ï¼‰ã€‚&lt;/p>
&lt;p>&lt;strong>æ€»ç»“&lt;/strong>ï¼š&lt;br>
â€‹å·²è¿è¡Œçš„è¿›ç¨‹ä¸å—å½±å“ï¼šLinuxé€šè¿‡&lt;code>inode&lt;/code>æ ‡è¯†æ–‡ä»¶ï¼Œæ—§è¿›ç¨‹ç»§ç»­æ‰§è¡Œå†…å­˜ä¸­å·²åŠ è½½çš„æ—§ä»£ç ï¼Œä¸åŸç£ç›˜æ–‡ä»¶è§£è€¦ã€‚&lt;/p>
&lt;hr>
&lt;h3 id="1-elfæ–‡ä»¶çš„æŒ‰éœ€åŠ è½½æœºåˆ¶">1. &lt;strong>ELFæ–‡ä»¶çš„æŒ‰éœ€åŠ è½½æœºåˆ¶&lt;/strong>&lt;/h3>
&lt;p>ELFäºŒè¿›åˆ¶æ–‡ä»¶é€šè¿‡&lt;strong>ç¨‹åºå¤´è¡¨ï¼ˆProgram Header Tableï¼‰&lt;strong>ä¸­çš„&lt;code>PT_LOAD&lt;/code>æ®µæè¿°éœ€è¦åŠ è½½çš„ä»£ç å’Œæ•°æ®åŒºåŸŸã€‚å†…æ ¸çš„&lt;code>load_elf_binary()&lt;/code>å‡½æ•°ä¼šå°†è¿™äº›æ®µæ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä½†å®é™…ç‰©ç†å†…å­˜çš„å ç”¨æ˜¯&lt;/strong>æŒ‰éœ€åˆ†é¡µ&lt;/strong>çš„ï¼š
â€¢ ä»…å½“ç¨‹åºè®¿é—®æŸä¸ªé¡µï¼ˆé€šå¸¸4KBå¤§å°ï¼‰æ—¶ï¼Œæ‰ä¼šè§¦å‘ç¼ºé¡µå¼‚å¸¸ï¼Œå°†å¯¹åº”å†…å®¹ä»ç£ç›˜åŠ è½½åˆ°ç‰©ç†å†…å­˜ã€‚
â€¢ æœªä½¿ç”¨çš„ä»£ç æˆ–æ•°æ®ï¼ˆå¦‚æœªæ‰§è¡Œçš„å‡½æ•°ï¼‰å¯èƒ½æ°¸è¿œä¸ä¼šè¢«åŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­ã€‚&lt;/p>
&lt;h3 id="2-è™šæ‹Ÿå†…å­˜æ˜ å°„ä¸å†…å­˜ä¼˜åŒ–">2. &lt;strong>è™šæ‹Ÿå†…å­˜æ˜ å°„ä¸å†…å­˜ä¼˜åŒ–&lt;/strong>&lt;/h3>
&lt;p>â€¢ &lt;strong>è™šæ‹Ÿå†…å­˜ä¼˜åŠ¿&lt;/strong>ï¼šELFæ–‡ä»¶é€šè¿‡&lt;code>mmap()&lt;/code>ç³»ç»Ÿè°ƒç”¨æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œæ­¤æ—¶æ–‡ä»¶å†…å®¹å¹¶ä¸ç›´æ¥å ç”¨ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯ç”±å†…æ ¸é€šè¿‡é¡µè¡¨ç®¡ç†ã€‚
â€¢ &lt;strong>å†™æ—¶å¤åˆ¶ï¼ˆCopy-on-Writeï¼‰&lt;/strong>ï¼šå¯¹äºåªè¯»æ®µï¼ˆå¦‚ä»£ç æ®µï¼‰ï¼Œå¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«åŒä¸€ç‰©ç†å†…å­˜é¡µï¼›å¯¹äºå¯å†™æ®µï¼Œä¿®æ”¹æ—¶æ‰ä¼šå¤åˆ¶æ–°é¡µã€‚&lt;/p>
&lt;h3 id="3-åŠ¨æ€é“¾æ¥ä¸å»¶è¿ŸåŠ è½½">3. &lt;strong>åŠ¨æ€é“¾æ¥ä¸å»¶è¿ŸåŠ è½½&lt;/strong>&lt;/h3>
&lt;p>åŠ¨æ€é“¾æ¥åº“ï¼ˆå¦‚&lt;code>.so&lt;/code>æ–‡ä»¶ï¼‰åœ¨ç¨‹åºè¿è¡Œæ—¶é€šè¿‡&lt;code>ld-linux&lt;/code>åŠ¨æ€åŠ è½½å™¨æŒ‰éœ€è½½å…¥ã€‚ä¾‹å¦‚ï¼š
â€¢ é¦–æ¬¡è°ƒç”¨æŸä¸ªåº“å‡½æ•°æ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨æ‰ä¼šåŠ è½½å¯¹åº”çš„ä»£ç æ®µåˆ°å†…å­˜ã€‚
â€¢ éƒ¨åˆ†åº“å¯èƒ½ä»…åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è¢«ä½¿ç”¨ï¼Œä»è€Œå‡å°‘åˆå§‹å†…å­˜å ç”¨ã€‚&lt;/p>
&lt;h3 id="4-å¤§æ–‡ä»¶çš„å®é™…å†…å­˜å ç”¨">4. &lt;strong>å¤§æ–‡ä»¶çš„å®é™…å†…å­˜å ç”¨&lt;/strong>&lt;/h3>
&lt;p>â€¢ &lt;strong>ç‰©ç†å†…å­˜é™åˆ¶&lt;/strong>ï¼šè‹¥äºŒè¿›åˆ¶æ–‡ä»¶æå¤§ï¼ˆå¦‚8GBï¼‰ï¼Œä½†ç¨‹åºå®é™…æ‰§è¡Œçš„ä»£ç è·¯å¾„æœ‰é™ï¼Œç‰©ç†å†…å­˜å ç”¨å¯èƒ½è¿œå°äºæ–‡ä»¶å¤§å°ã€‚
â€¢ &lt;strong>äº¤æ¢ç©ºé—´ï¼ˆSwapï¼‰&lt;/strong>ï¼šå½“ç‰©ç†å†…å­˜ä¸è¶³æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†ä¸æ´»è·ƒçš„å†…å­˜é¡µäº¤æ¢åˆ°ç£ç›˜ï¼Œè…¾å‡ºç©ºé—´ä¾›å½“å‰è¿›ç¨‹ä½¿ç”¨ã€‚&lt;/p></description></item><item><title>Linux å¤§æ–‡ä»¶ä¼ è¾“åœºæ™¯é¢˜</title><link>https://jekyulll.github.io/posts/linux-linux-%E5%A4%A7%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%9C%BA%E6%99%AF%E9%A2%98/</link><pubDate>Tue, 07 Jan 2025 20:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-linux-%E5%A4%A7%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%9C%BA%E6%99%AF%E9%A2%98/</guid><description>&lt;p>(è€ƒå¯Ÿlinuxç½‘ç»œç¼–ç¨‹ã€ç³»ç»Ÿç¼–ç¨‹ã€ç½‘ç»œåè®®ã€ç½‘ç»œä¼ è¾“åè®®ç­‰çŸ¥è¯†)&lt;/p>
&lt;blockquote>
&lt;p>é—®ï¼šå±€åŸŸç½‘å†…æœ‰Aã€Bã€Cä¸‰å°ä¸»æœºï¼ŒAä¸Bä¸çŸ¥é“ç›¸äº’ä¹‹é—´çš„IPã€‚Aè¦å‘Bä¼ è¾“ä¸€ä¸ª1Gçš„æ–‡ä»¶ï¼Œæ€ä¹ˆåšï¼Ÿ&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;ol>
&lt;li>å¤§æ–‡ä»¶ä¼ è¾“çš„ä¼˜åŒ–ï¼š&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>åˆ†å—ä¼ è¾“ï¼šå°†å¤§æ–‡ä»¶åˆ†æˆå¤šä¸ªå°å—ï¼ˆå¦‚4KBã€8KBç­‰ï¼‰ï¼Œæ¯æ¬¡ä¼ è¾“ä¸€å—ï¼Œé¿å…å ç”¨è¿‡å¤šå†…å­˜ã€‚&lt;/li>
&lt;li>æ ¡éªŒå’Œï¼ˆChecksumï¼‰ï¼šåœ¨æ¯ä¸€å—ä¼ è¾“åè¿›è¡Œæ•°æ®æ ¡éªŒï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚&lt;/li>
&lt;li>å¸¦å®½æ§åˆ¶ï¼šé€šè¿‡æ§åˆ¶æ¯æ¬¡å‘é€çš„æ•°æ®é‡æ¥é¿å…ä¸€æ¬¡æ€§ä¼ è¾“è¿‡å¤šæ•°æ®ï¼Œæ§åˆ¶ç½‘ç»œè´Ÿè½½ã€‚&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>æ–­ç‚¹ç»­ä¼ çš„å®ç°ï¼š&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>è®°å½•ä¼ è¾“è¿›åº¦ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½éœ€è¦è®°å½•å·²ç»æˆåŠŸä¼ è¾“çš„æ•°æ®å—æˆ–å­—èŠ‚çš„ä½ç½®ã€‚&lt;/li>
&lt;li>æ”¯æŒæ–­ç‚¹è¯·æ±‚ï¼šå®¢æˆ·ç«¯åœ¨æ¢å¤ä¼ è¾“æ—¶ï¼Œåº”è¯¥å‘ŠçŸ¥æœåŠ¡å™¨ä»å“ªä¸ªä½ç½®å¼€å§‹ä¼ è¾“ã€‚&lt;/li>
&lt;li>æ ¡éªŒå’Œå’Œç¡®è®¤æœºåˆ¶ï¼šæ¯æ¬¡ä¼ è¾“æ•°æ®å—åï¼Œéƒ½åº”è¯¥è¿›è¡Œç¡®è®¤ï¼Œç¡®ä¿æ•°æ®æ­£ç¡®ä¼ é€ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>&lt;strong>æ­¥éª¤&lt;/strong>ï¼š&lt;/p>
&lt;ol>
&lt;li>ä½¿ç”¨å±€åŸŸç½‘å¹¿æ’­å‘ç°Bçš„IPåœ°å€
ç”±äºAå’ŒBçš„IPåœ°å€ä¸ç›´æ¥å·²çŸ¥ï¼ŒAå¯ä»¥é€šè¿‡&lt;strong>å±€åŸŸç½‘å¹¿æ’­&lt;/strong>æ¥æ‰¾åˆ°Bçš„IPåœ°å€ã€‚Aå¯ä»¥å‘ç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºå‘é€ä¸€ä¸ª&lt;em>UDPå¹¿æ’­æ¶ˆæ¯&lt;/em>ï¼Œæ‰€æœ‰ä¸»æœºéƒ½ä¼šæ¥æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯ï¼ŒBåœ¨æ¥æ”¶åˆ°è¿™ä¸ªå¹¿æ’­åï¼Œå¯ä»¥å›å¤Aï¼Œå‘ŠçŸ¥è‡ªå·±çš„IPåœ°å€ã€‚&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;strong>UDPå¹¿æ’­&lt;/strong>ï¼šAå¯ä»¥é€šè¿‡å‘é€ä¸€ä¸ªUDPå¹¿æ’­åŒ…åˆ°ç‰¹å®šçš„ç«¯å£ï¼Œè®©å±€åŸŸç½‘ä¸­çš„æ‰€æœ‰ä¸»æœºæ”¶åˆ°è¯¥æ¶ˆæ¯ã€‚Bå¯ä»¥é€šè¿‡ç›‘å¬è¿™ä¸ªç«¯å£ï¼Œæ”¶åˆ°æ¶ˆæ¯åå›åº”è‡ªå·±çš„IPåœ°å€ã€‚&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>ä½¿ç”¨TCPåè®®è¿›è¡Œæ–‡ä»¶ä¼ è¾“
ä¸€æ—¦Aå¾—åˆ°äº†Bçš„IPåœ°å€ï¼Œå°±å¯ä»¥ä½¿ç”¨TCPåè®®è¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚Aé€šè¿‡TCPè¿æ¥åˆ°Bï¼Œå»ºç«‹æ•°æ®é€šé“ï¼Œå¼€å§‹å‘é€1GBçš„æ–‡ä»¶ã€‚&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="1-udpå¹¿æ’­å‘ç°bçš„ipåœ°å€">1. UDPå¹¿æ’­å‘ç°Bçš„IPåœ°å€&lt;/h3>
&lt;p>Aä½¿ç”¨UDPå¹¿æ’­å‘å±€åŸŸç½‘ä¸­çš„æ‰€æœ‰ä¸»æœºå‘é€è¯·æ±‚ï¼ŒBæ”¶åˆ°è¯·æ±‚åä¼šé€šè¿‡UDPå›åº”è‡ªå·±çš„IPåœ°å€ã€‚&lt;/p>
&lt;h4 id="aç«¯å‘é€udpå¹¿æ’­è¯·æ±‚">Aç«¯ï¼šå‘é€UDPå¹¿æ’­è¯·æ±‚&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;arpa/inet.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define BROADCAST_PORT 12345
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">send_broadcast_message&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> sockfd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">sockaddr_in&lt;/span> broadcast_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> broadcast_enable &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span>&lt;span style="color:#f92672">*&lt;/span> message &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Are you there, B? Please reply with your IP address.&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºUDPå¥—æ¥å­—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> sockfd &lt;span style="color:#f92672">=&lt;/span> socket(AF_INET, SOCK_DGRAM, &lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (sockfd &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> perror(&lt;span style="color:#e6db74">&amp;#34;Socket creation failed&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…è®¸å¹¿æ’­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (setsockopt(sockfd, SOL_SOCKET, SO_BROADCAST, &lt;span style="color:#f92672">&amp;amp;&lt;/span>broadcast_enable, &lt;span style="color:#66d9ef">sizeof&lt;/span>(broadcast_enable)) &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> perror(&lt;span style="color:#e6db74">&amp;#34;Setting broadcast option failed&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> close(sockfd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(&lt;span style="color:#f92672">&amp;amp;&lt;/span>broadcast_addr, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(broadcast_addr));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> broadcast_addr.sin_family &lt;span style="color:#f92672">=&lt;/span> AF_INET;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> broadcast_addr.sin_port &lt;span style="color:#f92672">=&lt;/span> htons(BROADCAST_PORT);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> broadcast_addr.sin_addr.s_addr &lt;span style="color:#f92672">=&lt;/span> htonl(INADDR_BROADCAST);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‘é€å¹¿æ’­æ¶ˆæ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (sendto(sockfd, message, strlen(message), &lt;span style="color:#ae81ff">0&lt;/span>, (&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">sockaddr&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#f92672">&amp;amp;&lt;/span>broadcast_addr, &lt;span style="color:#66d9ef">sizeof&lt;/span>(broadcast_addr)) &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> perror(&lt;span style="color:#e6db74">&amp;#34;Broadcast failed&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> close(sockfd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Broadcast message sent!&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> close(sockfd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> send_broadcast_message();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="bç«¯æ¥æ”¶udpå¹¿æ’­å¹¶å›åº”è‡ªå·±çš„ip">Bç«¯ï¼šæ¥æ”¶UDPå¹¿æ’­å¹¶å›åº”è‡ªå·±çš„IP&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;arpa/inet.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define BROADCAST_PORT 12345
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define RESPONSE_PORT 12346
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">listen_for_broadcasts&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> sockfd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">sockaddr_in&lt;/span> server_addr, client_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> socklen_t client_len &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">sizeof&lt;/span>(client_addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> buffer[&lt;span style="color:#ae81ff">1024&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ›å»ºUDPå¥—æ¥å­—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> sockfd &lt;span style="color:#f92672">=&lt;/span> socket(AF_INET, SOCK_DGRAM, &lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (sockfd &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> perror(&lt;span style="color:#e6db74">&amp;#34;Socket creation failed&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> memset(&lt;span style="color:#f92672">&amp;amp;&lt;/span>server_addr, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#66d9ef">sizeof&lt;/span>(server_addr));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> server_addr.sin_family &lt;span style="color:#f92672">=&lt;/span> AF_INET;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> server_addr.sin_port &lt;span style="color:#f92672">=&lt;/span> htons(BROADCAST_PORT);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> server_addr.sin_addr.s_addr &lt;span style="color:#f92672">=&lt;/span> htonl(INADDR_ANY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç»‘å®šUDPå¥—æ¥å­—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (bind(sockfd, (&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">sockaddr&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#f92672">&amp;amp;&lt;/span>server_addr, &lt;span style="color:#66d9ef">sizeof&lt;/span>(server_addr)) &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> perror(&lt;span style="color:#e6db74">&amp;#34;Bind failed&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> close(sockfd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ¥æ”¶å¹¿æ’­æ¶ˆæ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">while&lt;/span> (true) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> recv_len &lt;span style="color:#f92672">=&lt;/span> recvfrom(sockfd, buffer, &lt;span style="color:#66d9ef">sizeof&lt;/span>(buffer), &lt;span style="color:#ae81ff">0&lt;/span>, (&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">sockaddr&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#f92672">&amp;amp;&lt;/span>client_addr, &lt;span style="color:#f92672">&amp;amp;&lt;/span>client_len);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (recv_len &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> perror(&lt;span style="color:#e6db74">&amp;#34;Failed to receive message&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> buffer[recv_len] &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;\0&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Received message: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> buffer &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æœæ¶ˆæ¯åŒ…å«ç‰¹å®šè¯·æ±‚ï¼Œå¯ä»¥å›å¤è‡ªå·±çš„IPåœ°å€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>string response &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;IP Address of B: &amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> response &lt;span style="color:#f92672">+=&lt;/span> inet_ntoa(client_addr.sin_addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sendto(sockfd, response.c_str(), response.length(), &lt;span style="color:#ae81ff">0&lt;/span>, (&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">sockaddr&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#f92672">&amp;amp;&lt;/span>client_addr, client_len);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cout &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Sent response with IP address: &amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> inet_ntoa(client_addr.sin_addr) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> close(sockfd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> listen_for_broadcasts();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2-ä½¿ç”¨tcpåè®®ä¼ è¾“æ–‡ä»¶">2. ä½¿ç”¨TCPåè®®ä¼ è¾“æ–‡ä»¶&lt;/h3>
&lt;p>ä¸€æ—¦Aå¾—åˆ°äº†Bçš„IPåœ°å€ï¼ŒAå°±å¯ä»¥é€šè¿‡TCPè¿æ¥ä¸Bè¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚&lt;/p></description></item><item><title>Linux è¿›ç¨‹ä¼˜å…ˆçº§</title><link>https://jekyulll.github.io/posts/linux-linux-%E8%BF%9B%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7/</link><pubDate>Mon, 04 Nov 2024 21:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-linux-%E8%BF%9B%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7/</guid><description>&lt;h5 id="å›¾è§£linuxè¿›ç¨‹ä¼˜å…ˆçº§httpsmpweixinqqcoms__bizmzkyndiynzu4mgmid2247484435idx1snb6f30489cf388f1024d6883abb8237c8chksmc1d84682f6afcf94c1af14678d5401d558d2b728f0e6c853dbe4efe02c12dfa147369ceee13frd">&lt;a href="https://mp.weixin.qq.com/s?__biz=MzkyNDIyNzU4Mg==&amp;amp;mid=2247484435&amp;amp;idx=1&amp;amp;sn=b6f30489cf388f1024d6883abb8237c8&amp;amp;chksm=c1d84682f6afcf94c1af14678d5401d558d2b728f0e6c853dbe4efe02c12dfa147369ceee13f#rd">å›¾è§£Linuxè¿›ç¨‹ä¼˜å…ˆçº§&lt;/a>&lt;/h5>
&lt;p>&lt;em>å®æ—¶ä¼˜å…ˆçº§&lt;/em>ç”¨äºå®æ—¶åº”ç”¨ç¨‹åºï¼Œå¦‚ç¡¬å®æ—¶ä»»åŠ¡å’Œå®æ—¶æ§åˆ¶ç³»ç»Ÿï¼Œè€Œ&lt;em>æ™®é€šä¼˜å…ˆçº§&lt;/em>ç”¨äºéå®æ—¶åº”ç”¨ç¨‹åºã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å®æ—¶è¿›ç¨‹&lt;/strong>ï¼šåŠ¨æ€ä¼˜å…ˆçº§ä¸º0-99çš„è¿›ç¨‹ï¼Œé‡‡ç”¨&lt;em>å®æ—¶è°ƒåº¦ç®—æ³•&lt;/em>è°ƒåº¦ã€‚&lt;/li>
&lt;li>&lt;strong>æ™®é€šè¿›ç¨‹&lt;/strong>ï¼šåŠ¨æ€ä¼˜å…ˆçº§ä¸º100-139çš„è¿›ç¨‹ï¼Œé‡‡ç”¨&lt;em>å®Œå…¨å…¬å¹³è°ƒåº¦ç®—æ³•&lt;/em>è°ƒåº¦ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s?__biz=MzkyNDIyNzU4Mg==&amp;amp;mid=2247484458&amp;amp;idx=1&amp;amp;sn=e4e64c006d4d822c6e7c184ab50540c1&amp;amp;chksm=c1d846bbf6afcfad20af0a7132eca1e3fd3c765ea5d4ee4134985b2b03f2461c207239fcc208#rd">Linuxè¿›ç¨‹è°ƒåº¦ä¹‹å®Œå…¨å…¬å¹³è°ƒåº¦ï¼ˆå‹ç®±åº•çš„å¹²è´§åˆ†äº«ï¼‰&lt;/a>ã€‚å®Œå…¨å…¬å¹³è°ƒåº¦ï¼ŒCFS (Completely Fair Scheduler) ã€‚&lt;/p>
&lt;p>&lt;strong>niceå€¼&lt;/strong>ï¼šæ˜¯ç”¨äºè°ƒæ•´æ™®é€šè¿›ç¨‹ä¼˜å…ˆçº§çš„å‚æ•°ã€‚èŒƒå›´ï¼š&lt;code>-20&lt;/code>-&lt;code>19&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>task_struct {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> prio; 			&lt;span style="color:#75715e">// prioï¼ˆåŠ¨æ€ä¼˜å…ˆçº§ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> static_prio;	&lt;span style="color:#75715e">// static_prioï¼ˆé™æ€ä¼˜å…ˆçº§ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">int&lt;/span> normal_prio;	&lt;span style="color:#75715e">// normal_prioï¼ˆå½’ä¸€åŒ–ä¼˜å…ˆçº§ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> rt_priority; 	&lt;span style="color:#75715e">// rt_priorityï¼ˆå®æ—¶ä¼˜å…ˆçº§ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>&lt;code>prio&lt;/code>ï¼ˆåŠ¨æ€ä¼˜å…ˆçº§ï¼‰&lt;br>
åŠ¨æ€ä¼˜å…ˆçº§ï¼Œæœ‰æ•ˆä¼˜å…ˆçº§ï¼Œè°ƒåº¦å™¨æœ€ç»ˆä½¿ç”¨çš„ä¼˜å…ˆçº§æ•°å€¼ï¼ŒèŒƒå›´0-139ï¼Œå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚&lt;/li>
&lt;li>&lt;code>static_prio&lt;/code>ï¼ˆé™æ€ä¼˜å…ˆçº§ï¼‰&lt;br>
é™æ€ä¼˜å…ˆçº§ï¼Œé‡‡ç”¨&lt;code>SCHED_NORMAL&lt;/code>å’Œ&lt;code>SCHED_BATCH&lt;/code>è°ƒåº¦ç­–ç•¥çš„è¿›ç¨‹ï¼ˆå³æ™®é€šè¿›ç¨‹ï¼‰ç”¨äºè®¡ç®—åŠ¨æ€ä¼˜å…ˆçº§çš„ï¼ŒèŒƒå›´100-139ã€‚
prio = static_prio = nice + DEFAULT_PRIO = nice + 120&lt;/li>
&lt;li>&lt;code>normal_prio&lt;/code>ï¼ˆå½’ä¸€åŒ–ä¼˜å…ˆçº§ï¼‰&lt;br>
ç”¨äºè®¡ç®—&lt;code>prio&lt;/code>çš„ä¸­é—´å˜é‡ï¼Œä¸éœ€è¦å¤ªå…³å¿ƒã€‚&lt;/li>
&lt;li>&lt;code>rt_priority&lt;/code>ï¼ˆå®æ—¶ä¼˜å…ˆçº§ï¼‰&lt;br>
å®æ—¶ä¼˜å…ˆçº§ï¼Œé‡‡ç”¨&lt;code>SCHED_FIFO&lt;/code>å’Œ&lt;code>SCHED_RR&lt;/code>è°ƒåº¦ç­–ç•¥è¿›ç¨‹ï¼ˆå³å®æ—¶è¿›ç¨‹ï¼‰ç”¨äºè®¡ç®—åŠ¨æ€ä¼˜å…ˆçº§ï¼ŒèŒƒå›´0-99ã€‚
prio = MAX_RT_PRIO - 1 - rt_prio = 100 - 1 - rt_priority;&lt;/li>
&lt;/ol>
&lt;p>å®æ—¶ä¼˜å…ˆçº§æ•°å€¼è¶Šå¤§ï¼Œå¾—åˆ°çš„åŠ¨æ€ä¼˜å…ˆçº§æ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚&lt;/p>
&lt;p>&lt;code>ps -elf&lt;/code>å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹ä¼˜å…ˆçº§ã€‚&lt;code>PRI&lt;/code>ï¼šè¿›ç¨‹ä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ï¼ˆå¹¶éåŠ¨æ€ä¼˜å…ˆçº§ï¼‰&lt;code>NI&lt;/code>ï¼šniceå€¼ã€‚&lt;/p>
&lt;p>&lt;code>SCHED_FIFO&lt;/code>ï¼ˆå…ˆè¿›å…ˆå‡ºè°ƒåº¦ï¼‰å’Œ&lt;code>SCHED_RR&lt;/code>ï¼ˆæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ï¼‰ï¼Œè¿™äº›ç­–ç•¥å¯ä»¥é€šè¿‡&lt;code>sched_setscheduler()&lt;/code>ç³»ç»Ÿè°ƒç”¨ï¼ˆå¤´æ–‡ä»¶&lt;code>&amp;lt;sched.h&amp;gt;&lt;/code>ï¼‰æ¥è®¾ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">sched_param&lt;/span> param;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®ä¼˜å…ˆçº§ä¸ºæœ€é«˜ä¼˜å…ˆçº§
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> param.sched_priority &lt;span style="color:#f92672">=&lt;/span> sched_get_priority_max(SCHED_FIFO);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®è°ƒåº¦ç­–ç•¥ä¸ºSCHED_FIFO
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (sched_setscheduler(getpid(), SCHED_FIFO, &lt;span style="color:#f92672">&amp;amp;&lt;/span>param) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> std&lt;span style="color:#f92672">::&lt;/span>cerr &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;æ— æ³•è®¾ç½®å®æ—¶è°ƒåº¦ç­–ç•¥&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#f92672">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linux æ–‡ä»¶ç³»ç»Ÿä¸è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</title><link>https://jekyulll.github.io/posts/linux-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</link><pubDate>Mon, 04 Nov 2024 20:05:47 +0800</pubDate><guid>https://jekyulll.github.io/posts/linux-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</guid><description>&lt;h1 id="linux-æ–‡ä»¶ç³»ç»Ÿ">Linux æ–‡ä»¶ç³»ç»Ÿ&lt;/h1>
&lt;p>&lt;strong>æ–‡ä»¶æè¿°ç¬¦&lt;/strong>(File Descriptorï¼ŒFD)(winé‡Œä¸€èˆ¬ç§°ä¸ºæ–‡ä»¶å¥æŸ„)æ˜¯æ“ä½œç³»ç»Ÿä¸­ç”¨äºæ ‡è¯†å’Œç®¡ç†å·²æ‰“å¼€æ–‡ä»¶æˆ–I/Oèµ„æºçš„æ•´æ•°å€¼ã€‚&lt;br>
å½“è¿›ç¨‹è¯·æ±‚æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æˆ–èµ„æºæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸ºè¯¥èµ„æºåˆ†é…ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶å°†å…¶è¿”å›ç»™è¿›ç¨‹ã€‚è¿›ç¨‹éšåä½¿ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦æ¥è¿›è¡Œè¯»å†™æ“ä½œã€‚
æ˜¯ä¸€ä¸ªè¿›ç¨‹çº§åˆ«çš„æ¦‚å¿µã€‚&lt;/p>
&lt;ul>
&lt;li>ç»§æ‰¿ï¼šåœ¨åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œæ–‡ä»¶æè¿°ç¬¦å¯ä»¥åœ¨çˆ¶å­è¿›ç¨‹ä¹‹é—´å…±äº«ï¼ˆä¾‹å¦‚é€šè¿‡ fork()ï¼‰ã€‚&lt;/li>
&lt;li>å¤åˆ¶ï¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨ dup() æˆ– dup2() å¯ä»¥å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿å®ƒä»¬å¼•ç”¨åŒä¸€ä¸ªæ–‡ä»¶æˆ–èµ„æºã€‚&lt;/li>
&lt;/ul>
&lt;p>æ–‡ä»¶æè¿°ç¬¦ä¸ä»…ç”¨äºæ“ä½œæ–‡ä»¶ï¼Œè¿˜å¯ä»¥æŒ‡å‘ï¼š&lt;/p>
&lt;ul>
&lt;li>ç®¡é“ï¼ˆPipesï¼‰ï¼šç”¨äºè¿›ç¨‹é—´é€šä¿¡ã€‚&lt;/li>
&lt;li>å¥—æ¥å­—ï¼ˆSocketsï¼‰ï¼šç”¨äºç½‘ç»œé€šä¿¡ã€‚&lt;/li>
&lt;li>è®¾å¤‡æ–‡ä»¶ï¼šä¾‹å¦‚ç¡¬ç›˜ã€ä¸²å£ç­‰è®¾å¤‡ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æ–‡ä»¶åˆ†é…è¡¨&lt;/strong>(File Allocation Table, FAT)ã€‚&lt;/p>
&lt;p>&lt;a href="https://www.bilibili.com/video/BV1jy4y1K73r/?spm_id_from=333.337.search-card.all.click&amp;amp;vd_source=9b0b9cbfd8c349b95b4776bd10953f3a">ä½•ä¸ºæ–‡ä»¶ç´¢å¼•èŠ‚ç‚¹?æ–‡ä»¶ä¸ç£ç›˜çš„çˆ±æ¨æƒ…ä»‡ã€‚&lt;/a>ã€‚&lt;br>
&lt;a href="https://ruanyifeng.com/blog/2011/12/inode.html">é˜®ä¸€å³°çš„ä¸ªäººç½‘ç«™&lt;/a>ã€‚&lt;br>
&lt;strong>inode&lt;/strong>ï¼ˆç´¢å¼•èŠ‚ç‚¹ï¼‰ã€‚&lt;a href="https://ruanyifeng.com/blog/2011/12/inode.html">ç†è§£inode&lt;/a>ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ–‡ä»¶å‚¨å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œç¡¬ç›˜çš„æœ€å°å­˜å‚¨å•ä½å«åš&amp;quot;æ‰‡åŒº&amp;quot;ï¼ˆSectorï¼‰ã€‚æ¯ä¸ªæ‰‡åŒºå‚¨å­˜512å­—èŠ‚ï¼ˆç›¸å½“äº0.5KBï¼‰ã€‚
æ“ä½œç³»ç»Ÿè¯»å–ç¡¬ç›˜çš„æ—¶å€™ï¼Œä¸ä¼šä¸€ä¸ªä¸ªæ‰‡åŒºåœ°è¯»å–ï¼Œè¿™æ ·æ•ˆç‡å¤ªä½ï¼Œè€Œæ˜¯ä¸€æ¬¡æ€§è¿ç»­è¯»å–å¤šä¸ªæ‰‡åŒºï¼Œå³ä¸€æ¬¡æ€§è¯»å–ä¸€ä¸ª&amp;quot;å—&amp;quot;ï¼ˆblockï¼‰ã€‚è¿™ç§ç”±å¤šä¸ªæ‰‡åŒºç»„æˆçš„&amp;quot;å—&amp;quot;ï¼Œæ˜¯æ–‡ä»¶å­˜å–çš„æœ€å°å•ä½ã€‚&amp;ldquo;å—&amp;quot;çš„å¤§å°ï¼Œæœ€å¸¸è§çš„æ˜¯4KBï¼Œå³è¿ç»­å…«ä¸ª sectorç»„æˆä¸€ä¸ª blockã€‚
æ–‡ä»¶æ•°æ®éƒ½å‚¨å­˜åœ¨&amp;quot;å—&amp;quot;ä¸­ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªåœ°æ–¹å‚¨å­˜æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚æ–‡ä»¶çš„åˆ›å»ºè€…ã€æ–‡ä»¶çš„åˆ›å»ºæ—¥æœŸã€æ–‡ä»¶çš„å¤§å°ç­‰ç­‰ã€‚è¿™ç§å‚¨å­˜æ–‡ä»¶å…ƒä¿¡æ¯çš„åŒºåŸŸå°±å«åšinodeï¼Œä¸­æ–‡è¯‘åä¸º&amp;quot;ç´¢å¼•èŠ‚ç‚¹&amp;rdquo;ã€‚&lt;br>
å¯ä»¥ç”¨&lt;code>stat&lt;/code>å‘½ä»¤ï¼ŒæŸ¥çœ‹æŸä¸ªæ–‡ä»¶çš„inodeä¿¡æ¯ã€‚
inodeä¹Ÿä¼šæ¶ˆè€—ç¡¬ç›˜ç©ºé—´ï¼Œæ‰€ä»¥ç¡¬ç›˜æ ¼å¼åŒ–çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿè‡ªåŠ¨å°†ç¡¬ç›˜åˆ†æˆä¸¤ä¸ªåŒºåŸŸã€‚ä¸€ä¸ªæ˜¯æ•°æ®åŒºï¼Œå­˜æ”¾æ–‡ä»¶æ•°æ®ï¼›å¦ä¸€ä¸ªæ˜¯&lt;strong>inodeåŒº&lt;/strong>ï¼ˆinode tableï¼‰ï¼Œå­˜æ”¾inodeæ‰€åŒ…å«çš„ä¿¡æ¯ã€‚
Unix/Linuxç³»ç»Ÿå†…éƒ¨ä¸ä½¿ç”¨æ–‡ä»¶åï¼Œè€Œä½¿ç”¨inodeå·ç æ¥è¯†åˆ«æ–‡ä»¶ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;strong>è¶…çº§å—&lt;/strong>ï¼ˆSuperblockï¼‰ä½äºæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å¼€å¤´ï¼Œæä¾›äº†æ“ä½œç³»ç»Ÿå¦‚ä½•è§£é‡Šå’Œç®¡ç†è¯¥æ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®ã€‚(è®°å½•å„ä¸ªinode?)&lt;/p>
&lt;p>&lt;strong>è½¯é“¾æ¥å’Œç¡¬é“¾æ¥ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>è½¯é“¾æ¥æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†å¦ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚å®ƒç±»ä¼¼äº Windows ç³»ç»Ÿä¸­çš„å¿«æ·æ–¹å¼ã€‚&lt;/li>
&lt;li>ç¡¬é“¾æ¥æ˜¯æ–‡ä»¶çš„ä¸€ä¸ªç›´æ¥å¼•ç”¨ï¼ˆæˆ–è€…è¯´æ˜¯æŒ‡é’ˆï¼‰ï¼Œå®ƒä¸åŸæ–‡ä»¶å…±äº«ç›¸åŒçš„inodeã€‚åˆ é™¤åŸæ–‡ä»¶åï¼Œç¡¬é“¾æ¥ä»ç„¶æœ‰æ•ˆï¼Œå› ä¸ºå®ƒç›´æ¥å¼•ç”¨äº†æ–‡ä»¶çš„æ•°æ®ï¼›æ–‡ä»¶åªæœ‰å½“æ‰€æœ‰ç¡¬é“¾æ¥éƒ½è¢«åˆ é™¤åï¼Œæ•°æ®æ‰ä¼šè¢«æ¸…é™¤ã€‚inodeä¿¡æ¯ä¸­æœ‰ä¸€é¡¹å«åš&amp;quot;é“¾æ¥æ•°&amp;quot;ï¼Œè®°å½•æŒ‡å‘è¯¥inodeçš„æ–‡ä»¶åæ€»æ•°ã€‚&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>linuxè½¯ä»¶æ›´æ–°è¿‡ç¨‹ï¼šè½¯ä»¶æ›´æ–°å˜å¾—ç®€å•ï¼šç³»ç»Ÿé€šè¿‡inodeå·ç ï¼Œè¯†åˆ«è¿è¡Œä¸­çš„æ–‡ä»¶ï¼Œä¸é€šè¿‡æ–‡ä»¶åã€‚æ›´æ–°çš„æ—¶å€™ï¼Œæ–°ç‰ˆæ–‡ä»¶ä»¥åŒæ ·çš„æ–‡ä»¶åï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„inodeï¼Œä¸ä¼šå½±å“åˆ°è¿è¡Œä¸­çš„æ–‡ä»¶ã€‚ç­‰åˆ°ä¸‹ä¸€æ¬¡è¿è¡Œè¿™ä¸ªè½¯ä»¶çš„æ—¶å€™ï¼Œæ–‡ä»¶åå°±è‡ªåŠ¨æŒ‡å‘æ–°ç‰ˆæ–‡ä»¶ï¼Œæ—§ç‰ˆæ–‡ä»¶çš„inodeåˆ™è¢«å›æ”¶ã€‚&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;h1 id="linux-è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ">Linux è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ&lt;/h1>
&lt;p>&lt;a href="https://zhuanlan.zhihu.com/p/3815712411">linux I/OåŸç†ã€ç›‘æ§ã€å’Œè°ƒä¼˜æ€è·¯&lt;/a>ã€‚&lt;br>
&lt;a href="https://zhuanlan.zhihu.com/p/681048030">å›¾è§£Linuxè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ(VFS)ä¹‹å…³ç³»ç¯‡&lt;/a>ã€‚&lt;/p>
&lt;p>&lt;strong>è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ&lt;/strong>ï¼ˆVirtual File Systemï¼ŒVFSï¼‰ï¼šå®ƒæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œä½¿å¾—ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ç›¸åŒçš„æ–¹å¼è®¿é—®ä¸åŒç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p>
&lt;blockquote>
&lt;p>é€šè¿‡VFSç”¨æˆ·å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚&lt;code>open&lt;/code>ã€&lt;code>read&lt;/code>ã€&lt;code>write&lt;/code>ç­‰ï¼‰æ¥è®¿é—®ä¸åŒç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ext4ã€XFSç­‰ï¼‰ã€ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚NFSã€CIFSç­‰ï¼‰ä»¥åŠè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚procfsã€sysfsç­‰ï¼‰ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>VFSç”±ä»¥ä¸‹å‡ ä¸ªä¸»è¦ç»„ä»¶ç»„æˆï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿæ¥å£&lt;/strong>ï¼šVFSå®šä¹‰äº†ä¸€ç»„é€šç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œæ¥å£ã€‚&lt;/li>
&lt;li>&lt;strong>è¶…çº§å—(super_block)&lt;/strong>ï¼šæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªè¶…çº§å—ï¼Œå®ƒåŒ…å«äº†æ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€å—å¤§å°ã€inodeè¡¨ç­‰ï¼Œè¶…çº§å—æä¾›äº†å¯¹æ–‡ä»¶ç³»ç»Ÿçš„æ•´ä½“æè¿°å’Œç®¡ç†ã€‚&lt;/li>
&lt;li>&lt;strong>ç›®å½•é¡¹(dentry)&lt;/strong>ï¼šDirectory Entryï¼Œç”¨äºè¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•å’Œæ–‡ä»¶ï¼ŒdentryåŒ…å«äº†ç›®å½•å’Œæ–‡ä»¶å¯¹åº”çš„inodeæŒ‡é’ˆã€å±‚çº§å…³ç³»(parent)ç­‰ã€‚
&lt;blockquote>
&lt;p>dentryç»“æ„ä½“çš„ä¸»è¦ä½œç”¨æ˜¯æä¾›æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„çš„è¡¨ç¤ºï¼Œå®ƒä»¬é€šè¿‡å½¢æˆä¸€ä¸ªæ ‘çŠ¶ç»“æ„æ¥ç»„ç»‡ç›®å½•å’Œæ–‡ä»¶ï¼Œæ¯ä¸ªdentryéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„è·¯å¾„åï¼Œå¯ä»¥é€šè¿‡éå†dentryæ ‘æ¥æ‰¾åˆ°ç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•ã€‚&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">struct&lt;/span> dentry {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> dentry &lt;span style="color:#f92672">*&lt;/span>d_parent;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> qstr d_name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> inode &lt;span style="color:#f92672">*&lt;/span>d_inode;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> dentry_operations &lt;span style="color:#f92672">*&lt;/span>d_op;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> super_block &lt;span style="color:#f92672">*&lt;/span>d_sb;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> list_head d_child;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">struct&lt;/span> list_head d_subdirs;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ....
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>&lt;strong>æ–‡ä»¶èŠ‚ç‚¹(inode)&lt;/strong>ï¼šinodeæ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶æˆ–ç›®å½•çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶å¤§å°ã€æƒé™ã€æ‰€æœ‰è€…ç­‰ï¼Œæ¯ä¸ªæ–‡ä»¶æˆ–ç›®å½•éƒ½å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„inodeã€‚&lt;/li>
&lt;li>&lt;strong>æ–‡ä»¶å¯¹è±¡(file)&lt;/strong>ï¼šfileæ˜¯è¡¨ç¤ºæ‰“å¼€æ–‡ä»¶çš„æ•°æ®ç»“æ„ï¼Œå®ƒåŒ…å«äº†å¯¹åº”çš„inodeæŒ‡é’ˆã€å½“å‰è¯»å†™ä½ç½®ç­‰ä¿¡æ¯ï¼Œé€šè¿‡fileå¯ä»¥è¿›è¡Œæ–‡ä»¶çš„è¯»å†™æ“ä½œã€‚&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;strong>ç´¢å¼•èŠ‚ç‚¹&lt;/strong>(index node, inode)ï¼Œç”¨æ¥è®°å½•æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚ inode ç¼–å·ã€æ–‡ä»¶å¤§å°ã€è®¿é—®æƒé™ã€ä¿®æ”¹æ—¥æœŸã€æ•°æ®çš„ä½ç½®ç­‰ã€‚ç´¢å¼•èŠ‚ç‚¹å’Œæ–‡ä»¶ä¸€ä¸€å¯¹åº”ï¼Œå®ƒè·Ÿæ–‡ä»¶å†…å®¹ä¸€æ ·ï¼Œéƒ½ä¼šè¢«æŒä¹…åŒ–å­˜å‚¨åˆ°ç£ç›˜ä¸­ã€‚æ‰€ä»¥è®°ä½ï¼Œç´¢å¼•èŠ‚ç‚¹åŒæ ·å ç”¨ç£ç›˜ç©ºé—´ã€‚&lt;/li>
&lt;li>&lt;strong>ç›®å½•é¡¹&lt;/strong>(directory entry, dentry)ï¼Œç”¨æ¥è®°å½•æ–‡ä»¶çš„åå­—ã€ç´¢å¼•èŠ‚ç‚¹æŒ‡é’ˆä»¥åŠä¸å…¶ä»–ç›®å½•é¡¹çš„å…³è”å…³ç³»ã€‚å¤šä¸ªå…³è”çš„ç›®å½•é¡¹ï¼Œå°±æ„æˆäº†æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æ„ã€‚ä¸è¿‡ï¼Œä¸åŒäºç´¢å¼•èŠ‚ç‚¹ï¼Œç›®å½•é¡¹æ˜¯ç”±å†…æ ¸ç»´æŠ¤çš„ä¸€ä¸ªå†…å­˜æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥é€šå¸¸ä¹Ÿè¢«å«åšç›®å½•é¡¹ç¼“å­˜ã€‚&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>&lt;strong>ramfs&lt;/strong>æ˜¯ä¸€ç§åŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿã€‚å®ƒå°†æ‰€æœ‰çš„æ–‡ä»¶æ•°æ®å­˜å‚¨åœ¨å†…å­˜ï¼ˆRAMï¼‰ä¸­ï¼Œè€Œä¸æ˜¯åƒä¼ ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿé‚£æ ·å­˜å‚¨åœ¨ç£ç›˜ç­‰å¤–éƒ¨å­˜å‚¨è®¾å¤‡ä¸Šã€‚&lt;/p></description></item></channel></rss>